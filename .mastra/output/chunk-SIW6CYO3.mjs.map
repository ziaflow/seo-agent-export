{"version":3,"file":"chunk-SIW6CYO3.mjs","sources":["../../node_modules/@mastra/server/dist/chunk-SIW6CYO3.js"],"sourcesContent":["import { require_token_error } from './chunk-FZNS32WJ.js';\r\nimport { __commonJS, __require } from './chunk-PR4QN5HX.js';\r\n\r\n// ../../node_modules/.pnpm/@vercel+oidc@3.0.1/node_modules/@vercel/oidc/dist/token-io.js\r\nvar require_token_io = __commonJS({\r\n  \"../../node_modules/.pnpm/@vercel+oidc@3.0.1/node_modules/@vercel/oidc/dist/token-io.js\"(exports, module) {\r\n    var __create = Object.create;\r\n    var __defProp = Object.defineProperty;\r\n    var __getOwnPropDesc = Object.getOwnPropertyDescriptor;\r\n    var __getOwnPropNames = Object.getOwnPropertyNames;\r\n    var __getProtoOf = Object.getPrototypeOf;\r\n    var __hasOwnProp = Object.prototype.hasOwnProperty;\r\n    var __export = (target, all) => {\r\n      for (var name in all)\r\n        __defProp(target, name, { get: all[name], enumerable: true });\r\n    };\r\n    var __copyProps = (to, from, except, desc) => {\r\n      if (from && typeof from === \"object\" || typeof from === \"function\") {\r\n        for (let key of __getOwnPropNames(from))\r\n          if (!__hasOwnProp.call(to, key) && key !== except)\r\n            __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\r\n      }\r\n      return to;\r\n    };\r\n    var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(\r\n      // If the importer is in node compatibility mode or this is not an ESM\r\n      // file that has been converted to a CommonJS file using a Babel-\r\n      // compatible transform (i.e. \"__esModule\" has not been set), then set\r\n      // \"default\" to the CommonJS \"module.exports\" for node compatibility.\r\n      !mod || !mod.__esModule ? __defProp(target, \"default\", { value: mod, enumerable: true }) : target,\r\n      mod\r\n    ));\r\n    var __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\r\n    var token_io_exports = {};\r\n    __export(token_io_exports, {\r\n      findRootDir: () => findRootDir,\r\n      getUserDataDir: () => getUserDataDir\r\n    });\r\n    module.exports = __toCommonJS(token_io_exports);\r\n    var import_path = __toESM(__require(\"path\"));\r\n    var import_fs = __toESM(__require(\"fs\"));\r\n    var import_os = __toESM(__require(\"os\"));\r\n    var import_token_error = require_token_error();\r\n    function findRootDir() {\r\n      try {\r\n        let dir = process.cwd();\r\n        while (dir !== import_path.default.dirname(dir)) {\r\n          const pkgPath = import_path.default.join(dir, \".vercel\");\r\n          if (import_fs.default.existsSync(pkgPath)) {\r\n            return dir;\r\n          }\r\n          dir = import_path.default.dirname(dir);\r\n        }\r\n      } catch (e) {\r\n        throw new import_token_error.VercelOidcTokenError(\r\n          \"Token refresh only supported in node server environments\"\r\n        );\r\n      }\r\n      throw new import_token_error.VercelOidcTokenError(\"Unable to find root directory\");\r\n    }\r\n    function getUserDataDir() {\r\n      if (process.env.XDG_DATA_HOME) {\r\n        return process.env.XDG_DATA_HOME;\r\n      }\r\n      switch (import_os.default.platform()) {\r\n        case \"darwin\":\r\n          return import_path.default.join(import_os.default.homedir(), \"Library/Application Support\");\r\n        case \"linux\":\r\n          return import_path.default.join(import_os.default.homedir(), \".local/share\");\r\n        case \"win32\":\r\n          if (process.env.LOCALAPPDATA) {\r\n            return process.env.LOCALAPPDATA;\r\n          }\r\n          return null;\r\n        default:\r\n          return null;\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\n// ../../node_modules/.pnpm/@vercel+oidc@3.0.1/node_modules/@vercel/oidc/dist/token-util.js\r\nvar require_token_util = __commonJS({\r\n  \"../../node_modules/.pnpm/@vercel+oidc@3.0.1/node_modules/@vercel/oidc/dist/token-util.js\"(exports, module) {\r\n    var __create = Object.create;\r\n    var __defProp = Object.defineProperty;\r\n    var __getOwnPropDesc = Object.getOwnPropertyDescriptor;\r\n    var __getOwnPropNames = Object.getOwnPropertyNames;\r\n    var __getProtoOf = Object.getPrototypeOf;\r\n    var __hasOwnProp = Object.prototype.hasOwnProperty;\r\n    var __export = (target, all) => {\r\n      for (var name in all)\r\n        __defProp(target, name, { get: all[name], enumerable: true });\r\n    };\r\n    var __copyProps = (to, from, except, desc) => {\r\n      if (from && typeof from === \"object\" || typeof from === \"function\") {\r\n        for (let key of __getOwnPropNames(from))\r\n          if (!__hasOwnProp.call(to, key) && key !== except)\r\n            __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\r\n      }\r\n      return to;\r\n    };\r\n    var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(\r\n      // If the importer is in node compatibility mode or this is not an ESM\r\n      // file that has been converted to a CommonJS file using a Babel-\r\n      // compatible transform (i.e. \"__esModule\" has not been set), then set\r\n      // \"default\" to the CommonJS \"module.exports\" for node compatibility.\r\n      !mod || !mod.__esModule ? __defProp(target, \"default\", { value: mod, enumerable: true }) : target,\r\n      mod\r\n    ));\r\n    var __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\r\n    var token_util_exports = {};\r\n    __export(token_util_exports, {\r\n      assertVercelOidcTokenResponse: () => assertVercelOidcTokenResponse,\r\n      findProjectInfo: () => findProjectInfo,\r\n      getTokenPayload: () => getTokenPayload,\r\n      getVercelCliToken: () => getVercelCliToken,\r\n      getVercelDataDir: () => getVercelDataDir,\r\n      getVercelOidcToken: () => getVercelOidcToken,\r\n      isExpired: () => isExpired,\r\n      loadToken: () => loadToken,\r\n      saveToken: () => saveToken\r\n    });\r\n    module.exports = __toCommonJS(token_util_exports);\r\n    var path = __toESM(__require(\"path\"));\r\n    var fs = __toESM(__require(\"fs\"));\r\n    var import_token_error = require_token_error();\r\n    var import_token_io = require_token_io();\r\n    function getVercelDataDir() {\r\n      const vercelFolder = \"com.vercel.cli\";\r\n      const dataDir = (0, import_token_io.getUserDataDir)();\r\n      if (!dataDir) {\r\n        return null;\r\n      }\r\n      return path.join(dataDir, vercelFolder);\r\n    }\r\n    function getVercelCliToken() {\r\n      const dataDir = getVercelDataDir();\r\n      if (!dataDir) {\r\n        return null;\r\n      }\r\n      const tokenPath = path.join(dataDir, \"auth.json\");\r\n      if (!fs.existsSync(tokenPath)) {\r\n        return null;\r\n      }\r\n      const token = fs.readFileSync(tokenPath, \"utf8\");\r\n      if (!token) {\r\n        return null;\r\n      }\r\n      return JSON.parse(token).token;\r\n    }\r\n    async function getVercelOidcToken(authToken, projectId, teamId) {\r\n      try {\r\n        const url = `https://api.vercel.com/v1/projects/${projectId}/token?source=vercel-oidc-refresh${teamId ? `&teamId=${teamId}` : \"\"}`;\r\n        const res = await fetch(url, {\r\n          method: \"POST\",\r\n          headers: {\r\n            Authorization: `Bearer ${authToken}`\r\n          }\r\n        });\r\n        if (!res.ok) {\r\n          throw new import_token_error.VercelOidcTokenError(\r\n            `Failed to refresh OIDC token: ${res.statusText}`\r\n          );\r\n        }\r\n        const tokenRes = await res.json();\r\n        assertVercelOidcTokenResponse(tokenRes);\r\n        return tokenRes;\r\n      } catch (e) {\r\n        throw new import_token_error.VercelOidcTokenError(`Failed to refresh OIDC token`, e);\r\n      }\r\n    }\r\n    function assertVercelOidcTokenResponse(res) {\r\n      if (!res || typeof res !== \"object\") {\r\n        throw new TypeError(\"Expected an object\");\r\n      }\r\n      if (!(\"token\" in res) || typeof res.token !== \"string\") {\r\n        throw new TypeError(\"Expected a string-valued token property\");\r\n      }\r\n    }\r\n    function findProjectInfo() {\r\n      const dir = (0, import_token_io.findRootDir)();\r\n      if (!dir) {\r\n        throw new import_token_error.VercelOidcTokenError(\"Unable to find root directory\");\r\n      }\r\n      try {\r\n        const prjPath = path.join(dir, \".vercel\", \"project.json\");\r\n        if (!fs.existsSync(prjPath)) {\r\n          throw new import_token_error.VercelOidcTokenError(\"project.json not found\");\r\n        }\r\n        const prj = JSON.parse(fs.readFileSync(prjPath, \"utf8\"));\r\n        if (typeof prj.projectId !== \"string\" && typeof prj.orgId !== \"string\") {\r\n          throw new TypeError(\"Expected a string-valued projectId property\");\r\n        }\r\n        return { projectId: prj.projectId, teamId: prj.orgId };\r\n      } catch (e) {\r\n        throw new import_token_error.VercelOidcTokenError(`Unable to find project ID`, e);\r\n      }\r\n    }\r\n    function saveToken(token, projectId) {\r\n      try {\r\n        const dir = (0, import_token_io.getUserDataDir)();\r\n        if (!dir) {\r\n          throw new import_token_error.VercelOidcTokenError(\"Unable to find user data directory\");\r\n        }\r\n        const tokenPath = path.join(dir, \"com.vercel.token\", `${projectId}.json`);\r\n        const tokenJson = JSON.stringify(token);\r\n        fs.mkdirSync(path.dirname(tokenPath), { mode: 432, recursive: true });\r\n        fs.writeFileSync(tokenPath, tokenJson);\r\n        fs.chmodSync(tokenPath, 432);\r\n        return;\r\n      } catch (e) {\r\n        throw new import_token_error.VercelOidcTokenError(`Failed to save token`, e);\r\n      }\r\n    }\r\n    function loadToken(projectId) {\r\n      try {\r\n        const dir = (0, import_token_io.getUserDataDir)();\r\n        if (!dir) {\r\n          return null;\r\n        }\r\n        const tokenPath = path.join(dir, \"com.vercel.token\", `${projectId}.json`);\r\n        if (!fs.existsSync(tokenPath)) {\r\n          return null;\r\n        }\r\n        const token = JSON.parse(fs.readFileSync(tokenPath, \"utf8\"));\r\n        assertVercelOidcTokenResponse(token);\r\n        return token;\r\n      } catch (e) {\r\n        throw new import_token_error.VercelOidcTokenError(`Failed to load token`, e);\r\n      }\r\n    }\r\n    function getTokenPayload(token) {\r\n      const tokenParts = token.split(\".\");\r\n      if (tokenParts.length !== 3) {\r\n        throw new import_token_error.VercelOidcTokenError(\"Invalid token\");\r\n      }\r\n      const base64 = tokenParts[1].replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n      const padded = base64.padEnd(\r\n        base64.length + (4 - base64.length % 4) % 4,\r\n        \"=\"\r\n      );\r\n      return JSON.parse(Buffer.from(padded, \"base64\").toString(\"utf8\"));\r\n    }\r\n    var TIME_15_MINUTES_IN_MS = 15 * 60 * 1e3;\r\n    function isExpired(token) {\r\n      return token.exp * 1e3 < Date.now() + TIME_15_MINUTES_IN_MS;\r\n    }\r\n  }\r\n});\r\n\r\nexport { require_token_util };\r\n//# sourceMappingURL=chunk-SIW6CYO3.js.map\r\n//# sourceMappingURL=chunk-SIW6CYO3.js.map"],"names":[],"mappings":";;;;;;;;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;","x_google_ignoreList":[0]}