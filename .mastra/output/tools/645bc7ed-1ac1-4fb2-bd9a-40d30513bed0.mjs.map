{"version":3,"file":"645bc7ed-1ac1-4fb2-bd9a-40d30513bed0.mjs","sources":["../../../src/mastra/tools/seoAnalysisTool.ts"],"sourcesContent":["import { createTool } from \"@mastra/core/tools\";\r\nimport { z } from \"zod\";\r\n\r\n/**\r\n * SEO Analysis Tool\r\n * Evaluates on-page, technical, and structural SEO issues\r\n */\r\nexport const seoAnalysisTool = createTool({\r\n  id: \"seo-analysis\",\r\n  description:\r\n    \"Analyzes website for on-page SEO, technical SEO issues, and site structure problems\",\r\n  inputSchema: z.object({\r\n    websiteUrl: z.string().describe(\"The URL of the website to analyze\"),\r\n    analysisType: z\r\n      .enum([\"on-page\", \"technical\", \"structure\", \"astro\", \"all\"])\r\n      .describe(\"Type of SEO analysis to perform\"),\r\n  }),\r\n  outputSchema: z.object({\r\n    analysisType: z.string(),\r\n    issues: z.array(\r\n      z.object({\r\n        category: z.string(),\r\n        severity: z.enum([\"critical\", \"high\", \"medium\", \"low\"]),\r\n        issue: z.string(),\r\n        recommendation: z.string(),\r\n      })\r\n    ),\r\n    score: z.number().min(0).max(100),\r\n    summary: z.string(),\r\n  }),\r\n  execute: async ({ context, mastra }) => {\r\n    const logger = mastra?.getLogger();\r\n    logger?.info(\"üîç [SEO Analysis] Starting analysis\", {\r\n      url: context.websiteUrl,\r\n      type: context.analysisType,\r\n    });\r\n\r\n    const issues: Array<{\r\n      category: string;\r\n      severity: \"critical\" | \"high\" | \"medium\" | \"low\";\r\n      issue: string;\r\n      recommendation: string;\r\n    }> = [];\r\n\r\n    let html = \"\";\r\n    try {\r\n        const response = await fetch(context.websiteUrl);\r\n        html = await response.text();\r\n    } catch (error) {\r\n        logger?.error(\"Failed to fetch website\", { error });\r\n        issues.push({\r\n            category: \"Accessibility\",\r\n            severity: \"critical\",\r\n            issue: \"Website is not accessible\",\r\n            recommendation: \"Check server status and DNS configuration\",\r\n        });\r\n        return {\r\n            analysisType: context.analysisType,\r\n            issues,\r\n            score: 0,\r\n            summary: \"Failed to access website.\",\r\n        };\r\n    }\r\n\r\n    // Real analysis logic\r\n    if (\r\n      context.analysisType === \"on-page\" ||\r\n      context.analysisType === \"all\"\r\n    ) {\r\n      logger?.info(\"üìÑ [SEO Analysis] Analyzing on-page elements\");\r\n      \r\n      const titleMatch = html.match(/<title>(.*?)<\\/title>/i);\r\n      if (!titleMatch || !titleMatch[1]) {\r\n          issues.push({\r\n              category: \"Meta Tags\",\r\n              severity: \"high\",\r\n              issue: \"Missing title tag\",\r\n              recommendation: \"Add a descriptive title tag.\",\r\n          });\r\n      } else if (titleMatch[1].length < 10 || titleMatch[1].length > 60) {\r\n           issues.push({\r\n              category: \"Meta Tags\",\r\n              severity: \"medium\",\r\n              issue: `Title tag length is ${titleMatch[1].length} characters (recommended: 10-60)`,\r\n              recommendation: \"Optimize title tag length.\",\r\n          });\r\n      }\r\n\r\n      const metaDescMatch = html.match(/<meta\\s+name=[\"']description[\"']\\s+content=[\"'](.*?)[\"']/i);\r\n      if (!metaDescMatch || !metaDescMatch[1]) {\r\n          issues.push({\r\n              category: \"Meta Tags\",\r\n              severity: \"high\",\r\n              issue: \"Missing meta description\",\r\n              recommendation: \"Add a compelling meta description (120-160 characters).\",\r\n          });\r\n      }\r\n\r\n      const h1Match = html.match(/<h1[^>]*>(.*?)<\\/h1>/gi);\r\n      if (!h1Match) {\r\n          issues.push({\r\n              category: \"Headings\",\r\n              severity: \"high\",\r\n              issue: \"Missing H1 tag\",\r\n              recommendation: \"Add exactly one H1 tag per page.\",\r\n          });\r\n      } else if (h1Match.length > 1) {\r\n          issues.push({\r\n              category: \"Headings\",\r\n              severity: \"medium\",\r\n              issue: `Found ${h1Match.length} H1 tags`,\r\n              recommendation: \"Use only one H1 tag per page.\",\r\n          });\r\n      }\r\n    }\r\n\r\n    if (\r\n      context.analysisType === \"technical\" ||\r\n      context.analysisType === \"all\"\r\n    ) {\r\n      logger?.info(\"‚öôÔ∏è [SEO Analysis] Analyzing technical SEO\");\r\n      // Basic check for viewport\r\n      if (!html.includes('name=\"viewport\"')) {\r\n           issues.push({\r\n              category: \"Mobile Friendliness\",\r\n              severity: \"high\",\r\n              issue: \"Viewport meta tag missing\",\r\n              recommendation: \"Add <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1\\\">\",\r\n          });\r\n      }\r\n    }\r\n\r\n    if (\r\n      context.analysisType === \"structure\" ||\r\n      context.analysisType === \"all\"\r\n    ) {\r\n      logger?.info(\"üèóÔ∏è [SEO Analysis] Analyzing site structure\");\r\n      // Basic check for URL structure (context.websiteUrl)\r\n      if (context.websiteUrl.includes('_')) {\r\n        issues.push({\r\n          category: \"URL Structure\",\r\n          severity: \"medium\",\r\n          issue: \"URL contains underscores\",\r\n          recommendation: \"Use hyphens instead of underscores in URLs.\",\r\n        });\r\n      }\r\n    }\r\n\r\n    if (\r\n      context.analysisType === \"astro\" ||\r\n      context.analysisType === \"all\"\r\n    ) {\r\n      logger?.info(\"üöÄ [SEO Analysis] Analyzing Astro JS specific optimizations\");\r\n      // Simple check for Astro generator tag\r\n      if (!html.includes('name=\"generator\" content=\"Astro')) {\r\n          // Not necessarily an issue if they hid it, but good to note\r\n      }\r\n      \r\n      // Check for client directives\r\n      if (html.includes('client:load')) {\r\n           issues.push({\r\n              category: \"Astro Optimization\",\r\n              severity: \"low\",\r\n              issue: \"Found client:load directive\",\r\n              recommendation: \"Ensure client:load is necessary; prefer client:visible or client:idle.\",\r\n          });\r\n      }\r\n    }\r\n\r\n    const score = Math.max(0, 100 - issues.length * 10);\r\n    logger?.info(\"‚úÖ [SEO Analysis] Analysis complete\", { score });\r\n\r\n    return {\r\n      analysisType: context.analysisType,\r\n      issues,\r\n      score,\r\n      summary: `Found ${issues.length} SEO issues. Overall SEO score: ${score}/100`,\r\n    };\r\n  },\r\n});\r\n"],"names":[],"mappings":"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"}