{"version":3,"file":"aac44e71-3fc8-4b11-ac64-c5f2ecf2f8bf.mjs","sources":["../../../src/mastra/tools/seoSchemaInspectorTool.ts"],"sourcesContent":["import { createTool } from \"@mastra/core/tools\";\r\nimport { z } from \"zod\";\r\nimport { storeSeoSchemaSnapshot } from \"../storage/analyticsDb\";\r\n\r\n/**\r\n * SEO Schema Inspector Tool\r\n * Crawls a URL, inspects JSON-LD / microdata, and records issues.\r\n */\r\nexport const seoSchemaInspectorTool = createTool({\r\n  id: \"seo-schema-inspector\",\r\n  description:\r\n    \"Audits a webpage for structured data coverage, missing schema types, and Rich Results issues.\",\r\n  inputSchema: z.object({\r\n    websiteUrl: z.string().url().describe(\"Page URL to audit\"),\r\n    requiredSchemaTypes: z\r\n      .array(z.string())\r\n      .default([])\r\n      .describe(\"Schema types that must exist (e.g., Article, BreadcrumbList)\"),\r\n  }),\r\n  outputSchema: z.object({\r\n    websiteUrl: z.string(),\r\n    schemaTypes: z.array(z.string()),\r\n    missingTypes: z.array(z.string()),\r\n    warnings: z.array(z.string()),\r\n    detectedIssues: z.array(\r\n      z.object({\r\n        type: z.string(),\r\n        severity: z.enum([\"critical\", \"high\", \"medium\", \"low\"]),\r\n        message: z.string(),\r\n      }),\r\n    ),\r\n    crawledAt: z.string(),\r\n  }),\r\n  execute: async ({ context, mastra }) => {\r\n    const logger = mastra?.getLogger();\r\n    logger?.info(\"ðŸ§© [Schema Inspector] Auditing structured data\", {\r\n      url: context.websiteUrl,\r\n    });\r\n\r\n    // Placeholder crawl logic (replace with real fetch + DOM parse later)\r\n    const detectedTypes = [\"Article\", \"BreadcrumbList\", \"WebSite\"];\r\n    const missingTypes = context.requiredSchemaTypes.filter(\r\n      (type) => !detectedTypes.includes(type),\r\n    );\r\n\r\n    const issues = missingTypes.map((type) => ({\r\n      type,\r\n      severity: \"high\" as const,\r\n      message: `${type} schema missing from page`,\r\n    }));\r\n\r\n    const warnings: string[] = [];\r\n    if (!detectedTypes.includes(\"FAQPage\")) {\r\n      warnings.push(\"FAQPage schema absent; add for rich FAQ snippets\");\r\n    }\r\n\r\n    const payload = {\r\n      websiteUrl: context.websiteUrl,\r\n      schemaTypes: detectedTypes,\r\n      missingTypes,\r\n      warnings,\r\n      detectedIssues: issues,\r\n      crawledAt: new Date().toISOString(),\r\n    };\r\n\r\n    await storeSeoSchemaSnapshot(payload);\r\n    logger?.info(\"âœ… [Schema Inspector] Snapshot stored\", {\r\n      missingTypes: payload.missingTypes.length,\r\n    });\r\n\r\n    return payload;\r\n  },\r\n});\r\n"],"names":[],"mappings":";;;;;AAQO,MAAM,yBAAyB,UAAA,CAAW;AAAA,EAC/C,EAAA,EAAI,sBAAA;AAAA,EACJ,WAAA,EACE,+FAAA;AAAA,EACF,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,YAAY,CAAA,CAAE,MAAA,GAAS,GAAA,EAAI,CAAE,SAAS,mBAAmB,CAAA;AAAA,IACzD,mBAAA,EAAqB,CAAA,CAClB,KAAA,CAAM,CAAA,CAAE,MAAA,EAAQ,CAAA,CAChB,OAAA,CAAQ,EAAE,CAAA,CACV,QAAA,CAAS,8DAA8D;AAAA,GAC3E,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,UAAA,EAAY,EAAE,MAAA,EAAO;AAAA,IACrB,WAAA,EAAa,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,QAAQ,CAAA;AAAA,IAC/B,YAAA,EAAc,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,QAAQ,CAAA;AAAA,IAChC,QAAA,EAAU,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,QAAQ,CAAA;AAAA,IAC5B,gBAAgB,CAAA,CAAE,KAAA;AAAA,MAChB,EAAE,MAAA,CAAO;AAAA,QACP,IAAA,EAAM,EAAE,MAAA,EAAO;AAAA,QACf,QAAA,EAAU,EAAE,IAAA,CAAK,CAAC,YAAY,MAAA,EAAQ,QAAA,EAAU,KAAK,CAAC,CAAA;AAAA,QACtD,OAAA,EAAS,EAAE,MAAA;AAAO,OACnB;AAAA,KACH;AAAA,IACA,SAAA,EAAW,EAAE,MAAA;AAAO,GACrB,CAAA;AAAA,EACD,OAAA,EAAS,OAAO,EAAE,OAAA,EAAS,QAAO,KAAM;AACtC,IAAA,MAAM,MAAA,GAAS,QAAQ,SAAA,EAAU;AACjC,IAAA,MAAA,EAAQ,KAAK,uDAAA,EAAkD;AAAA,MAC7D,KAAK,OAAA,CAAQ;AAAA,KACd,CAAA;AAGD,IAAA,MAAM,aAAA,GAAgB,CAAC,SAAA,EAAW,gBAAA,EAAkB,SAAS,CAAA;AAC7D,IAAA,MAAM,YAAA,GAAe,QAAQ,mBAAA,CAAoB,MAAA;AAAA,MAC/C,CAAC,IAAA,KAAS,CAAC,aAAA,CAAc,SAAS,IAAI;AAAA,KACxC;AAEA,IAAA,MAAM,MAAA,GAAS,YAAA,CAAa,GAAA,CAAI,CAAC,IAAA,MAAU;AAAA,MACzC,IAAA;AAAA,MACA,QAAA,EAAU,MAAA;AAAA,MACV,OAAA,EAAS,GAAG,IAAI,CAAA,yBAAA;AAAA,KAClB,CAAE,CAAA;AAEF,IAAA,MAAM,WAAqB,EAAC;AAC5B,IAAA,IAAI,CAAC,aAAA,CAAc,QAAA,CAAS,SAAS,CAAA,EAAG;AACtC,MAAA,QAAA,CAAS,KAAK,kDAAkD,CAAA;AAAA,IAClE;AAEA,IAAA,MAAM,OAAA,GAAU;AAAA,MACd,YAAY,OAAA,CAAQ,UAAA;AAAA,MACpB,WAAA,EAAa,aAAA;AAAA,MACb,YAAA;AAAA,MACA,QAAA;AAAA,MACA,cAAA,EAAgB,MAAA;AAAA,MAChB,SAAA,EAAA,iBAAW,IAAI,IAAA,EAAK,EAAE,WAAA;AAAY,KACpC;AAEA,IAAA,MAAM,uBAAuB,OAAO,CAAA;AACpC,IAAA,MAAA,EAAQ,KAAK,2CAAA,EAAwC;AAAA,MACnD,YAAA,EAAc,QAAQ,YAAA,CAAa;AAAA,KACpC,CAAA;AAED,IAAA,OAAO,OAAA;AAAA,EACT;AACF,CAAC;;;;"}