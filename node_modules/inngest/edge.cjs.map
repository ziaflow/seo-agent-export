{"version":3,"file":"edge.cjs","names":["frameworkName: SupportedFrameworkName","InngestCommHandler","headers: Record<string, string>"],"sources":["../src/edge.ts"],"sourcesContent":["/**\n * An adapter for any request that handles standard Web APIs such as `fetch`,\n * `Request,` and `Response` to serve and register any declared functions with\n * Inngest, making them available to be triggered by events.\n *\n * This is reused by many other adapters, but can be used directly.\n *\n * @example\n * ```ts\n * import { serve } from \"inngest/edge\";\n * import functions from \"~/inngest\";\n *\n * export const handler = serve({ id: \"my-edge-app\", functions });\n * ```\n *\n * @module\n */\n\nimport type { Inngest } from \"./components/Inngest.ts\";\nimport {\n  InngestCommHandler,\n  type ServeHandlerOptions,\n  type SyncHandlerOptions,\n} from \"./components/InngestCommHandler.ts\";\nimport type { RegisterOptions, SupportedFrameworkName } from \"./types.ts\";\n\n/**\n * The name of the framework, used to identify the framework in Inngest\n * dashboards and during testing.\n */\nexport const frameworkName: SupportedFrameworkName = \"edge\";\n\nexport type EdgeHandler = (req: Request) => Promise<Response>;\n\nconst commHandler = (\n  options: RegisterOptions & { client: Inngest.Like },\n  syncOptions?: SyncHandlerOptions,\n) => {\n  const handler = new InngestCommHandler({\n    frameworkName,\n    fetch: fetch.bind(globalThis),\n    ...options,\n    syncOptions,\n    handler: (req: Request) => {\n      return {\n        body: () => req.json(),\n        textBody: () => req.text(),\n        headers: (key: string) => req.headers.get(key),\n        method: () => req.method,\n        url: () => new URL(req.url, `https://${req.headers.get(\"host\") || \"\"}`),\n        transformResponse: ({ body, status, headers }) => {\n          return new Response(body, { status, headers });\n        },\n        experimentalTransformSyncResponse: async (data) => {\n          const res = data as Response;\n\n          const headers: Record<string, string> = {};\n          res.headers.forEach((v, k) => {\n            headers[k] = v;\n          });\n\n          return {\n            headers: headers,\n            status: res.status,\n            body: await res.clone().text(),\n          };\n        },\n      };\n    },\n  });\n\n  return handler;\n};\n\n/**\n * In an edge runtime, serve and register any declared functions with Inngest,\n * making them available to be triggered by events.\n *\n * The edge runtime is a generic term for any serverless runtime that supports\n * only standard Web APIs such as `fetch`, `Request`, and `Response`, such as\n * Cloudflare Workers, Vercel Edge Functions, and AWS Lambda@Edge.\n *\n * @example\n * ```ts\n * import { serve } from \"inngest/edge\";\n * import functions from \"~/inngest\";\n *\n * export const handler = serve({ id: \"my-edge-app\", functions });\n * ```\n *\n * @public\n */\n// Has explicit return type to avoid JSR-defined \"slow types\"\nexport const serve = (options: ServeHandlerOptions): EdgeHandler => {\n  return commHandler(options).createHandler();\n};\n\n/**\n * In an edge runtime, create a function that can wrap any endpoint to be able\n * to use steps seamlessly within that API.\n *\n * The edge runtime is a generic term for any serverless runtime that supports\n * only standard Web APIs such as `fetch`, `Request`, and `Response`, such as\n * Cloudflare Workers, Vercel Edge Functions, and AWS Lambda@Edge.\n *\n * @example\n * ```ts\n * import { Inngest, step } from \"inngest\";\n * import { createExperimentalEndpointWrapper } from \"inngest/edge\";\n *\n * const wrap = createExperimentalEndpointWrapper({\n *   client: new Inngest({ id: \"my-app\" }),\n * });\n *\n * Bun.serve({\n *   routes: {\n *     \"/\": wrap(async (req) => {\n *       const foo = await step.run(\"my-step\", () => ({ foo: \"bar\" }));\n *\n *       return new Response(`Result: ${JSON.stringify(foo)}`);\n *     }),\n *   },\n * });\n * ```\n */\nexport const createExperimentalEndpointWrapper = (\n  options: SyncHandlerOptions,\n) => {\n  return commHandler(options, options).createSyncHandler();\n};\n"],"mappings":";;;;;;;AA8BA,MAAaA,gBAAwC;AAIrD,MAAM,eACJ,SACA,gBACG;AAkCH,QAjCgB,IAAIC,8CAAmB;EACrC;EACA,OAAO,MAAM,KAAK,WAAW;EAC7B,GAAG;EACH;EACA,UAAU,QAAiB;AACzB,UAAO;IACL,YAAY,IAAI,MAAM;IACtB,gBAAgB,IAAI,MAAM;IAC1B,UAAU,QAAgB,IAAI,QAAQ,IAAI,IAAI;IAC9C,cAAc,IAAI;IAClB,WAAW,IAAI,IAAI,IAAI,KAAK,WAAW,IAAI,QAAQ,IAAI,OAAO,IAAI,KAAK;IACvE,oBAAoB,EAAE,MAAM,QAAQ,cAAc;AAChD,YAAO,IAAI,SAAS,MAAM;MAAE;MAAQ;MAAS,CAAC;;IAEhD,mCAAmC,OAAO,SAAS;KACjD,MAAM,MAAM;KAEZ,MAAMC,UAAkC,EAAE;AAC1C,SAAI,QAAQ,SAAS,GAAG,MAAM;AAC5B,cAAQ,KAAK;OACb;AAEF,YAAO;MACI;MACT,QAAQ,IAAI;MACZ,MAAM,MAAM,IAAI,OAAO,CAAC,MAAM;MAC/B;;IAEJ;;EAEJ,CAAC;;;;;;;;;;;;;;;;;;;;AAwBJ,MAAa,SAAS,YAA8C;AAClE,QAAO,YAAY,QAAQ,CAAC,eAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+B7C,MAAa,qCACX,YACG;AACH,QAAO,YAAY,SAAS,QAAQ,CAAC,mBAAmB"}