{"version":3,"file":"eventLoopUtilizationCollector.js","sourceRoot":"","sources":["../../../src/metrics/eventLoopUtilizationCollector.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;GAcG;;;AAEH,qDAAoE;AAEpE,mDAAgD;AAChD,wCAAiE;AAEjE,MAAM,EAAE,oBAAoB,EAAE,6BAA6B,EAAE,GAAG,6BAAW,CAAC;AAE5E,MAAa,6BAA8B,SAAQ,6BAAa;IAC9D,iGAAiG;IACjG,mGAAmG;IAC3F,UAAU,GAAyB,6BAA6B,EAAE,CAAC;IAEpE,uBAAuB,CAAC,KAAY;QACzC,KAAK;aACF,qBAAqB,CAAC,6CAAmC,EAAE;YAC1D,WAAW,EAAE,wBAAwB;YACrC,IAAI,EAAE,GAAG;SACV,CAAC;aACD,WAAW,CAAC,KAAK,EAAC,gBAAgB,EAAC,EAAE;YACpC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO;gBAAE,OAAO;YAElC,MAAM,UAAU,GAAG,6BAA6B,EAAE,CAAC;YACnD,MAAM,QAAQ,GAAG,6BAA6B,CAC5C,UAAU,EACV,IAAI,CAAC,UAAU,CAChB,CAAC;YACF,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;YAC7B,gBAAgB,CAAC,OAAO,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QACjD,CAAC,CAAC,CAAC;IACP,CAAC;IAES,eAAe,KAAU,CAAC;IAE1B,cAAc,KAAU,CAAC;CACpC;AA3BD,sEA2BC","sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventLoopUtilization, performance } from 'node:perf_hooks';\nimport { Meter } from '@opentelemetry/api';\nimport { BaseCollector } from './baseCollector';\nimport { METRIC_NODEJS_EVENTLOOP_UTILIZATION } from '../semconv';\n\nconst { eventLoopUtilization: eventLoopUtilizationCollector } = performance;\n\nexport class EventLoopUtilizationCollector extends BaseCollector {\n  // Value needs to be initialized the first time otherwise the first measurement would always be 1\n  // See https://github.com/open-telemetry/opentelemetry-js-contrib/pull/3118#issuecomment-3429737955\n  private _lastValue: EventLoopUtilization = eventLoopUtilizationCollector();\n\n  public updateMetricInstruments(meter: Meter): void {\n    meter\n      .createObservableGauge(METRIC_NODEJS_EVENTLOOP_UTILIZATION, {\n        description: 'Event loop utilization',\n        unit: '1',\n      })\n      .addCallback(async observableResult => {\n        if (!this._config.enabled) return;\n\n        const currentELU = eventLoopUtilizationCollector();\n        const deltaELU = eventLoopUtilizationCollector(\n          currentELU,\n          this._lastValue\n        );\n        this._lastValue = currentELU;\n        observableResult.observe(deltaELU.utilization);\n      });\n  }\n\n  protected internalDisable(): void {}\n\n  protected internalEnable(): void {}\n}\n"]}