import { InngestCommHandler } from "./components/InngestCommHandler.js";

//#region src/edge.ts
/**
* The name of the framework, used to identify the framework in Inngest
* dashboards and during testing.
*/
const frameworkName = "edge";
const commHandler = (options, syncOptions) => {
	return new InngestCommHandler({
		frameworkName,
		fetch: fetch.bind(globalThis),
		...options,
		syncOptions,
		handler: (req) => {
			return {
				body: () => req.json(),
				textBody: () => req.text(),
				headers: (key) => req.headers.get(key),
				method: () => req.method,
				url: () => new URL(req.url, `https://${req.headers.get("host") || ""}`),
				transformResponse: ({ body, status, headers }) => {
					return new Response(body, {
						status,
						headers
					});
				},
				experimentalTransformSyncResponse: async (data) => {
					const res = data;
					const headers = {};
					res.headers.forEach((v, k) => {
						headers[k] = v;
					});
					return {
						headers,
						status: res.status,
						body: await res.clone().text()
					};
				}
			};
		}
	});
};
/**
* In an edge runtime, serve and register any declared functions with Inngest,
* making them available to be triggered by events.
*
* The edge runtime is a generic term for any serverless runtime that supports
* only standard Web APIs such as `fetch`, `Request`, and `Response`, such as
* Cloudflare Workers, Vercel Edge Functions, and AWS Lambda@Edge.
*
* @example
* ```ts
* import { serve } from "inngest/edge";
* import functions from "~/inngest";
*
* export const handler = serve({ id: "my-edge-app", functions });
* ```
*
* @public
*/
const serve = (options) => {
	return commHandler(options).createHandler();
};
/**
* In an edge runtime, create a function that can wrap any endpoint to be able
* to use steps seamlessly within that API.
*
* The edge runtime is a generic term for any serverless runtime that supports
* only standard Web APIs such as `fetch`, `Request`, and `Response`, such as
* Cloudflare Workers, Vercel Edge Functions, and AWS Lambda@Edge.
*
* @example
* ```ts
* import { Inngest, step } from "inngest";
* import { createExperimentalEndpointWrapper } from "inngest/edge";
*
* const wrap = createExperimentalEndpointWrapper({
*   client: new Inngest({ id: "my-app" }),
* });
*
* Bun.serve({
*   routes: {
*     "/": wrap(async (req) => {
*       const foo = await step.run("my-step", () => ({ foo: "bar" }));
*
*       return new Response(`Result: ${JSON.stringify(foo)}`);
*     }),
*   },
* });
* ```
*/
const createExperimentalEndpointWrapper = (options) => {
	return commHandler(options, options).createSyncHandler();
};

//#endregion
export { createExperimentalEndpointWrapper, frameworkName, serve };
//# sourceMappingURL=edge.js.map