{"version":3,"sources":["../src/mastra/index.ts","../src/events/event-emitter.ts","../src/mastra/hooks.ts"],"names":["MastraError","saveScorePayloadSchema","InstrumentClass","Mastra","randomUUID","InMemoryServerCache","WorkflowEventProcessor","LogLevel","ConsoleLogger","augmentWithInit","Telemetry","setupAITracing","registerHook","getAllAITracing","shutdownAITracingRegistry","__decoratorStart","__decorateElement","__runInitializers"],"mappings":"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","file":"chunk-PPCSJI73.cjs","sourcesContent":["import { randomUUID } from 'node:crypto';\nimport type { Agent } from '../agent';\nimport { getAllAITracing, setupAITracing, shutdownAITracingRegistry } from '../ai-tracing';\nimport type { ObservabilityRegistryConfig } from '../ai-tracing';\nimport type { BundlerConfig } from '../bundler/types';\nimport { InMemoryServerCache } from '../cache';\nimport type { MastraServerCache } from '../cache';\nimport type { MastraDeployer } from '../deployer';\nimport { MastraError, ErrorDomain, ErrorCategory } from '../error';\nimport { EventEmitterPubSub } from '../events/event-emitter';\nimport type { PubSub } from '../events/pubsub';\nimport type { Event } from '../events/types';\nimport { AvailableHooks, registerHook } from '../hooks';\nimport { LogLevel, noopLogger, ConsoleLogger } from '../logger';\nimport type { IMastraLogger } from '../logger';\nimport type { MCPServerBase } from '../mcp';\nimport type { MastraMemory } from '../memory/memory';\nimport type { MastraScorer } from '../scores';\nimport type { Middleware, ServerConfig } from '../server/types';\nimport type { MastraStorage } from '../storage';\nimport { augmentWithInit } from '../storage/storageWithInit';\nimport { InstrumentClass, Telemetry } from '../telemetry';\nimport type { OtelConfig } from '../telemetry';\nimport type { MastraTTS } from '../tts';\nimport type { MastraIdGenerator } from '../types';\nimport type { MastraVector } from '../vector';\nimport type { Workflow } from '../workflows';\nimport { WorkflowEventProcessor } from '../workflows/evented/workflow-event-processor';\nimport type { LegacyWorkflow } from '../workflows/legacy';\nimport { createOnScorerHook } from './hooks';\n\n/**\n * Configuration interface for initializing a Mastra instance.\n *\n * The Config interface defines all the optional components that can be registered\n * with a Mastra instance, including agents, workflows, storage, logging, and more.\n *\n * @template TAgents - Record of agent instances keyed by their names\n * @template TLegacyWorkflows - Record of legacy workflow instances\n * @template TWorkflows - Record of workflow instances\n * @template TVectors - Record of vector store instances\n * @template TTTS - Record of text-to-speech instances\n * @template TLogger - Logger implementation type\n * @template TVNextNetworks - Record of agent network instances\n * @template TMCPServers - Record of MCP server instances\n * @template TScorers - Record of scorer instances\n *\n * @example\n * ```typescript\n * const mastra = new Mastra({\n *   agents: {\n *     weatherAgent: new Agent({\n *       name: 'weather-agent',\n *       instructions: 'You help with weather information',\n *       model: 'openai/gpt-5'\n *     })\n *   },\n *   storage: new LibSQLStore({ url: ':memory:' }),\n *   logger: new PinoLogger({ name: 'MyApp' })\n * });\n * ```\n */\nexport interface Config<\n  TAgents extends Record<string, Agent<any>> = Record<string, Agent<any>>,\n  TLegacyWorkflows extends Record<string, LegacyWorkflow> = Record<string, LegacyWorkflow>,\n  TWorkflows extends Record<string, Workflow<any, any, any, any, any, any>> = Record<\n    string,\n    Workflow<any, any, any, any, any, any>\n  >,\n  TVectors extends Record<string, MastraVector> = Record<string, MastraVector>,\n  TTTS extends Record<string, MastraTTS> = Record<string, MastraTTS>,\n  TLogger extends IMastraLogger = IMastraLogger,\n  TMCPServers extends Record<string, MCPServerBase> = Record<string, MCPServerBase>,\n  TScorers extends Record<string, MastraScorer<any, any, any, any>> = Record<string, MastraScorer<any, any, any, any>>,\n> {\n  /**\n   * Agents are autonomous systems that can make decisions and take actions.\n   */\n  agents?: TAgents;\n\n  /**\n   * Storage provider for persisting data, conversation history, and workflow state.\n   * Required for agent memory and workflow persistence.\n   */\n  storage?: MastraStorage;\n\n  /**\n   * Vector stores for semantic search and retrieval-augmented generation (RAG).\n   * Used for storing and querying embeddings.\n   */\n  vectors?: TVectors;\n\n  /**\n   * Logger implementation for application logging and debugging.\n   * Set to `false` to disable logging entirely.\n   * @default `INFO` level in development, `WARN` in production.\n   */\n  logger?: TLogger | false;\n\n  /**\n   * Legacy workflow definitions for backward compatibility.\n   * @deprecated Use `workflows` instead.\n   */\n  legacy_workflows?: TLegacyWorkflows;\n\n  /**\n   * Workflows provide type-safe, composable task execution with built-in error handling.\n   */\n  workflows?: TWorkflows;\n\n  /**\n   * Text-to-speech providers for voice synthesis capabilities.\n   */\n  tts?: TTTS;\n\n  /**\n   * OpenTelemetry configuration for distributed tracing and observability.\n   *\n   * @deprecated Use {@link observability} instead.\n   */\n  telemetry?: OtelConfig;\n\n  /**\n   * AI-specific observability configuration for tracking model interactions.\n   */\n  observability?: ObservabilityRegistryConfig;\n\n  /**\n   * Custom ID generator function for creating unique identifiers.\n   * @default `crypto.randomUUID()`\n   */\n  idGenerator?: MastraIdGenerator;\n\n  /**\n   * Deployment provider for publishing applications to cloud platforms.\n   */\n  deployer?: MastraDeployer;\n\n  /**\n   * Server configuration for HTTP endpoints and middleware.\n   */\n  server?: ServerConfig;\n\n  /**\n   * MCP servers provide tools and resources that agents can use.\n   */\n  mcpServers?: TMCPServers;\n\n  /**\n   * Bundler configuration for packaging and deployment.\n   */\n  bundler?: BundlerConfig;\n\n  /**\n   * Pub/sub system for event-driven communication between components.\n   * @default EventEmitterPubSub\n   */\n  pubsub?: PubSub;\n\n  /**\n   * Scorers help assess the quality of agent responses and workflow outputs.\n   */\n  scorers?: TScorers;\n\n  /**\n   * Server middleware functions to be applied to API routes\n   * Each middleware can specify a path pattern (defaults to '/api/*')\n   * @deprecated use server.middleware instead\n   */\n  serverMiddleware?: Array<{\n    handler: (c: any, next: () => Promise<void>) => Promise<Response | void>;\n    path?: string;\n  }>;\n\n  // @deprecated add memory to your Agent directly instead\n  memory?: never;\n\n  /**\n   * Event handlers for custom application events.\n   * Maps event topics to handler functions for event-driven architectures.\n   */\n  events?: {\n    [topic: string]: (\n      event: Event,\n      cb?: () => Promise<void>,\n    ) => Promise<void> | ((event: Event, cb?: () => Promise<void>) => Promise<void>)[];\n  };\n}\n\n@InstrumentClass({\n  prefix: 'mastra',\n  excludeMethods: ['getLogger', 'getTelemetry'],\n})\n/**\n * The central orchestrator for Mastra applications, managing agents, workflows, storage, logging, telemetry, and more.\n *\n * The `Mastra` class serves as the main entry point and registry for all components in a Mastra application.\n * It coordinates the interaction between agents, workflows, storage systems, and other services.\n\n * @template TAgents - Record of agent instances keyed by their names\n * @template TLegacyWorkflows - Record of legacy workflow instances for backward compatibility\n * @template TWorkflows - Record of modern workflow instances\n * @template TVectors - Record of vector store instances for semantic search and RAG\n * @template TTTS - Record of text-to-speech provider instances\n * @template TLogger - Logger implementation type for application logging\n * @template TVNextNetworks - Record of next-generation agent network instances\n * @template TMCPServers - Record of Model Context Protocol server instances\n * @template TScorers - Record of evaluation scorer instances for measuring AI performance\n *\n * @example\n * ```typescript\n * const mastra = new Mastra({\n *   agents: {\n *     weatherAgent: new Agent({\n *       name: 'weather-agent',\n *       instructions: 'You provide weather information',\n *       model: 'openai/gpt-5',\n *       tools: [getWeatherTool]\n *     })\n *   },\n *   workflows: { dataWorkflow },\n *   storage: new LibSQLStore({ url: ':memory:' }),\n *   logger: new PinoLogger({ name: 'MyApp' })\n * });\n * ```\n */\nexport class Mastra<\n  TAgents extends Record<string, Agent<any>> = Record<string, Agent<any>>,\n  TLegacyWorkflows extends Record<string, LegacyWorkflow> = Record<string, LegacyWorkflow>,\n  TWorkflows extends Record<string, Workflow<any, any, any, any, any, any>> = Record<\n    string,\n    Workflow<any, any, any, any, any, any>\n  >,\n  TVectors extends Record<string, MastraVector> = Record<string, MastraVector>,\n  TTTS extends Record<string, MastraTTS> = Record<string, MastraTTS>,\n  TLogger extends IMastraLogger = IMastraLogger,\n  TMCPServers extends Record<string, MCPServerBase> = Record<string, MCPServerBase>,\n  TScorers extends Record<string, MastraScorer<any, any, any, any>> = Record<string, MastraScorer<any, any, any, any>>,\n> {\n  #vectors?: TVectors;\n  #agents: TAgents;\n  #logger: TLogger;\n  #legacy_workflows: TLegacyWorkflows;\n  #workflows: TWorkflows;\n  #tts?: TTTS;\n  #deployer?: MastraDeployer;\n  #serverMiddleware: Array<{\n    handler: (c: any, next: () => Promise<void>) => Promise<Response | void>;\n    path: string;\n  }> = [];\n\n  /**\n   * @deprecated Use {@link getAITracing()} instead.\n   */\n  #telemetry?: Telemetry;\n  #storage?: MastraStorage;\n  #memory?: MastraMemory;\n  #scorers?: TScorers;\n  #server?: ServerConfig;\n  #mcpServers?: TMCPServers;\n  #bundler?: BundlerConfig;\n  #idGenerator?: MastraIdGenerator;\n  #pubsub: PubSub;\n  #events: {\n    [topic: string]: ((event: Event, cb?: () => Promise<void>) => Promise<void>)[];\n  } = {};\n  #internalMastraWorkflows: Record<string, Workflow> = {};\n  // This is only used internally for server handlers that require temporary persistence\n  #serverCache: MastraServerCache;\n\n  /**\n   * @deprecated use {@link getAITracing()} instead\n   */\n  get telemetry() {\n    return this.#telemetry;\n  }\n\n  /**\n   * @deprecated use getStorage() instead\n   */\n  get storage() {\n    return this.#storage;\n  }\n\n  /**\n   * @deprecated use getMemory() instead\n   */\n  get memory() {\n    return this.#memory;\n  }\n\n  get pubsub() {\n    return this.#pubsub;\n  }\n\n  /**\n   * Gets the currently configured ID generator function.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   idGenerator: () => `custom-${Date.now()}`\n   * });\n   * const generator = mastra.getIdGenerator();\n   * console.log(generator?.()); // \"custom-1234567890\"\n   * ```\n   */\n  public getIdGenerator() {\n    return this.#idGenerator;\n  }\n\n  /**\n   * Generates a unique identifier using the configured generator or defaults to `crypto.randomUUID()`.\n   *\n   * This method is used internally by Mastra for creating unique IDs for various entities\n   * like workflow runs, agent conversations, and other resources that need unique identification.\n   *\n   * @throws {MastraError} When the custom ID generator returns an empty string\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const id = mastra.generateId();\n   * console.log(id); // \"550e8400-e29b-41d4-a716-446655440000\"\n   * ```\n   */\n  public generateId(): string {\n    if (this.#idGenerator) {\n      const id = this.#idGenerator();\n      if (!id) {\n        const error = new MastraError({\n          id: 'MASTRA_ID_GENERATOR_RETURNED_EMPTY_STRING',\n          domain: ErrorDomain.MASTRA,\n          category: ErrorCategory.USER,\n          text: 'ID generator returned an empty string, which is not allowed',\n        });\n        this.#logger?.trackException(error);\n        throw error;\n      }\n      return id;\n    }\n    return randomUUID();\n  }\n\n  /**\n   * Sets a custom ID generator function for creating unique identifiers.\n   *\n   * The ID generator function will be used by `generateId()` instead of the default\n   * `crypto.randomUUID()`. This is useful for creating application-specific ID formats\n   * or integrating with existing ID generation systems.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * mastra.setIdGenerator(() => `custom-${Date.now()}`);\n   * const id = mastra.generateId();\n   * console.log(id); // \"custom-1234567890\"\n   * ```\n   */\n  public setIdGenerator(idGenerator: MastraIdGenerator) {\n    this.#idGenerator = idGenerator;\n  }\n\n  /**\n   * Creates a new Mastra instance with the provided configuration.\n   *\n   * The constructor initializes all the components specified in the config, sets up\n   * internal systems like logging and telemetry, and registers components with each other.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: {\n   *     assistant: new Agent({\n   *       name: 'assistant',\n   *       instructions: 'You are a helpful assistant',\n   *       model: 'openai/gpt-5'\n   *     })\n   *   },\n   *   storage: new PostgresStore({\n   *     connectionString: process.env.DATABASE_URL\n   *   }),\n   *   logger: new PinoLogger({ name: 'MyApp' })\n   * });\n   * ```\n   */\n  constructor(config?: Config<TAgents, TLegacyWorkflows, TWorkflows, TVectors, TTTS, TLogger, TMCPServers, TScorers>) {\n    // Store server middleware with default path\n    if (config?.serverMiddleware) {\n      this.#serverMiddleware = config.serverMiddleware.map(m => ({\n        handler: m.handler,\n        path: m.path || '/api/*',\n      }));\n    }\n\n    /*\n    Server Cache\n    */\n\n    // This is only used internally for server handlers that require temporary persistence\n    this.#serverCache = new InMemoryServerCache();\n\n    /*\n    Events\n    */\n    if (config?.pubsub) {\n      this.#pubsub = config.pubsub;\n    } else {\n      this.#pubsub = new EventEmitterPubSub();\n    }\n\n    this.#events = {};\n    for (const topic in config?.events ?? {}) {\n      if (!Array.isArray(config?.events?.[topic])) {\n        this.#events[topic] = [config?.events?.[topic] as any];\n      } else {\n        this.#events[topic] = config?.events?.[topic] ?? [];\n      }\n    }\n\n    const workflowEventProcessor = new WorkflowEventProcessor({ mastra: this });\n    const workflowEventCb = async (event: Event, cb?: () => Promise<void>): Promise<void> => {\n      try {\n        await workflowEventProcessor.process(event, cb);\n      } catch (e) {\n        console.error('Error processing event', e);\n      }\n    };\n    if (this.#events.workflows) {\n      this.#events.workflows.push(workflowEventCb);\n    } else {\n      this.#events.workflows = [workflowEventCb];\n    }\n\n    /*\n      Logger\n    */\n\n    let logger: TLogger;\n    if (config?.logger === false) {\n      logger = noopLogger as unknown as TLogger;\n    } else {\n      if (config?.logger) {\n        logger = config.logger;\n      } else {\n        const levelOnEnv =\n          process.env.NODE_ENV === 'production' && process.env.MASTRA_DEV !== 'true' ? LogLevel.WARN : LogLevel.INFO;\n        logger = new ConsoleLogger({ name: 'Mastra', level: levelOnEnv }) as unknown as TLogger;\n      }\n    }\n    this.#logger = logger;\n\n    this.#idGenerator = config?.idGenerator;\n\n    let storage = config?.storage;\n\n    if (storage) {\n      storage = augmentWithInit(storage);\n    }\n\n    /*\n    Telemetry\n    */\n\n    this.#telemetry = Telemetry.init(config?.telemetry);\n\n    // Warn if telemetry is enabled but the instrumentation global is not set\n    if (\n      config?.telemetry?.enabled !== false &&\n      typeof globalThis !== 'undefined' &&\n      (globalThis as any).___MASTRA_TELEMETRY___ !== true\n    ) {\n      this.#logger?.warn(\n        `Mastra telemetry is enabled, but the required instrumentation file was not loaded. ` +\n          `If you are using Mastra outside of the mastra server environment, see: https://mastra.ai/en/docs/observability/tracing#tracing-outside-mastra-server-environment`,\n        `If you are using a custom instrumentation file or want to disable this warning, set the globalThis.___MASTRA_TELEMETRY___ variable to true in your instrumentation file.`,\n      );\n    }\n\n    if (config?.telemetry?.enabled !== false) {\n      this.#logger?.warn(\n        `Mastra telemetry is deprecated and will be removed on the Nov 4th release. Instead use AI Tracing. ` +\n          `More info can be found here: https://github.com/mastra-ai/mastra/issues/8577 and here: https://mastra.ai/en/docs/observability/ai-tracing/overview`,\n      );\n    }\n\n    /*\n    AI Tracing\n    */\n\n    if (config?.observability) {\n      setupAITracing(config.observability);\n    }\n\n    /*\n      Storage\n    */\n    if (this.#telemetry && storage) {\n      this.#storage = this.#telemetry.traceClass(storage, {\n        excludeMethods: ['__setTelemetry', '__getTelemetry', 'batchTraceInsert', 'getTraces', 'getEvalsByAgentName'],\n      });\n      this.#storage.__setTelemetry(this.#telemetry);\n    } else {\n      this.#storage = storage;\n    }\n\n    /*\n    Vectors\n    */\n    if (config?.vectors) {\n      let vectors: Record<string, MastraVector> = {};\n      Object.entries(config.vectors).forEach(([key, vector]) => {\n        if (this.#telemetry) {\n          vectors[key] = this.#telemetry.traceClass(vector, {\n            excludeMethods: ['__setTelemetry', '__getTelemetry'],\n          });\n          vectors[key].__setTelemetry(this.#telemetry);\n        } else {\n          vectors[key] = vector;\n        }\n      });\n\n      this.#vectors = vectors as TVectors;\n    }\n\n    if (config?.mcpServers) {\n      this.#mcpServers = config.mcpServers;\n\n      // Set logger/telemetry/Mastra instance/id for MCP servers\n      Object.entries(this.#mcpServers).forEach(([key, server]) => {\n        server.setId(key);\n        if (this.#telemetry) {\n          server.__setTelemetry(this.#telemetry);\n        }\n\n        server.__registerMastra(this);\n        server.__setLogger(this.getLogger());\n      });\n    }\n\n    if (config && `memory` in config) {\n      const error = new MastraError({\n        id: 'MASTRA_CONSTRUCTOR_INVALID_MEMORY_CONFIG',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `\n  Memory should be added to Agents, not to Mastra.\n\nInstead of:\n  new Mastra({ memory: new Memory() })\n\ndo:\n  new Agent({ memory: new Memory() })\n`,\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    if (config?.tts) {\n      this.#tts = config.tts;\n      Object.entries(this.#tts).forEach(([key, ttsCl]) => {\n        if (this.#tts?.[key]) {\n          if (this.#telemetry) {\n            // @ts-ignore\n            this.#tts[key] = this.#telemetry.traceClass(ttsCl, {\n              excludeMethods: ['__setTelemetry', '__getTelemetry'],\n            });\n            this.#tts[key].__setTelemetry(this.#telemetry);\n          }\n        }\n      });\n    }\n\n    /*\n    Agents\n    */\n    const agents: Record<string, Agent> = {};\n    if (config?.agents) {\n      Object.entries(config.agents).forEach(([key, agent]) => {\n        if (agents[key]) {\n          const error = new MastraError({\n            id: 'MASTRA_AGENT_REGISTRATION_DUPLICATE_ID',\n            domain: ErrorDomain.MASTRA,\n            category: ErrorCategory.USER,\n            text: `Agent with name ID:${key} already exists`,\n            details: {\n              agentId: key,\n            },\n          });\n          this.#logger?.trackException(error);\n          throw error;\n        }\n        agent.__registerMastra(this);\n\n        agent.__registerPrimitives({\n          logger: this.getLogger(),\n          telemetry: this.#telemetry,\n          storage: this.storage,\n          memory: this.memory,\n          agents: agents,\n          tts: this.#tts,\n          vectors: this.#vectors,\n        });\n\n        agents[key] = agent;\n      });\n    }\n\n    this.#agents = agents as TAgents;\n\n    /**\n     * Scorers\n     */\n\n    const scorers = {} as Record<string, MastraScorer<any, any, any, any>>;\n    if (config?.scorers) {\n      Object.entries(config.scorers).forEach(([key, scorer]) => {\n        scorers[key] = scorer;\n      });\n    }\n    this.#scorers = scorers as TScorers;\n\n    /*\n    Legacy Workflows\n    */\n    this.#legacy_workflows = {} as TLegacyWorkflows;\n\n    if (config?.legacy_workflows) {\n      Object.entries(config.legacy_workflows).forEach(([key, workflow]) => {\n        workflow.__registerMastra(this);\n        workflow.__registerPrimitives({\n          logger: this.getLogger(),\n          telemetry: this.#telemetry,\n          storage: this.storage,\n          memory: this.memory,\n          agents: agents,\n          tts: this.#tts,\n          vectors: this.#vectors,\n        });\n        // @ts-ignore\n        this.#legacy_workflows[key] = workflow;\n\n        const workflowSteps = Object.values(workflow.steps).filter(step => !!step.workflowId && !!step.workflow);\n        if (workflowSteps.length > 0) {\n          workflowSteps.forEach(step => {\n            // @ts-ignore\n            this.#legacy_workflows[step.workflowId] = step.workflow;\n          });\n        }\n      });\n    }\n\n    this.#workflows = {} as TWorkflows;\n    if (config?.workflows) {\n      Object.entries(config.workflows).forEach(([key, workflow]) => {\n        workflow.__registerMastra(this);\n        workflow.__registerPrimitives({\n          logger: this.getLogger(),\n          telemetry: this.#telemetry,\n          storage: this.storage,\n          memory: this.memory,\n          agents: agents,\n          tts: this.#tts,\n          vectors: this.#vectors,\n        });\n        // @ts-ignore\n        this.#workflows[key] = workflow;\n      });\n    }\n\n    if (config?.server) {\n      this.#server = config.server;\n    }\n\n    registerHook(AvailableHooks.ON_SCORER_RUN, createOnScorerHook(this));\n\n    /*\n      Register Mastra instance with AI tracing exporters and initialize them\n    */\n    if (config?.observability) {\n      this.registerAITracingExporters();\n      this.initAITracingExporters();\n    }\n\n    this.setLogger({ logger });\n  }\n\n  /**\n   * Register this Mastra instance with AI tracing exporters that need it\n   */\n  private registerAITracingExporters(): void {\n    const allTracingInstances = getAllAITracing();\n    allTracingInstances.forEach(tracing => {\n      const exporters = tracing.getExporters();\n      exporters.forEach(exporter => {\n        // Check if exporter has __registerMastra method\n        if ('__registerMastra' in exporter && typeof (exporter as any).__registerMastra === 'function') {\n          (exporter as any).__registerMastra(this);\n        }\n      });\n    });\n  }\n\n  /**\n   * Initialize all AI tracing exporters after registration is complete\n   */\n  private initAITracingExporters(): void {\n    const allTracingInstances = getAllAITracing();\n\n    allTracingInstances.forEach(tracing => {\n      const config = tracing.getConfig();\n      const exporters = tracing.getExporters();\n      exporters.forEach(exporter => {\n        // Initialize exporter if it has an init method\n        if ('init' in exporter && typeof exporter.init === 'function') {\n          try {\n            exporter.init(config);\n          } catch (error) {\n            this.#logger?.warn('Failed to initialize AI tracing exporter', {\n              exporterName: exporter.name,\n              error: error instanceof Error ? error.message : String(error),\n            });\n          }\n        }\n      });\n    });\n  }\n\n  /**\n   * Retrieves a registered agent by its name.\n   *\n   * @template TAgentName - The specific agent name type from the registered agents\n   * @throws {MastraError} When the agent with the specified name is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: {\n   *     weatherAgent: new Agent({\n   *       name: 'weather-agent',\n   *       instructions: 'You provide weather information',\n   *       model: 'openai/gpt-5'\n   *     })\n   *   }\n   * });\n   * const agent = mastra.getAgent('weatherAgent');\n   * const response = await agent.generate('What is the weather?');\n   * ```\n   */\n  public getAgent<TAgentName extends keyof TAgents>(name: TAgentName): TAgents[TAgentName] {\n    const agent = this.#agents?.[name];\n    if (!agent) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_AGENT_BY_NAME_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Agent with name ${String(name)} not found`,\n        details: {\n          status: 404,\n          agentName: String(name),\n          agents: Object.keys(this.#agents ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return this.#agents[name];\n  }\n\n  /**\n   * Retrieves a registered agent by its unique ID.\n   *\n   * This method searches for an agent using its internal ID property. If no agent\n   * is found with the given ID, it also attempts to find an agent using the ID as\n   * a name (for backward compatibility).\n   *\n   * @throws {MastraError} When no agent is found with the specified ID\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: {\n   *     assistant: new Agent({\n   *       name: 'assistant',\n   *       instructions: 'You are a helpful assistant',\n   *       model: 'openai/gpt-5'\n   *     })\n   *   }\n   * });\n   *\n   * const assistant = mastra.getAgent('assistant');\n   * const sameAgent = mastra.getAgentById(assistant.id);\n   * ```\n   */\n  public getAgentById(id: string): Agent {\n    let agent = Object.values(this.#agents).find(a => a.id === id);\n\n    if (!agent) {\n      try {\n        agent = this.getAgent(id as any);\n      } catch {\n        // do nothing\n      }\n    }\n\n    if (!agent) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_AGENT_BY_AGENT_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Agent with id ${String(id)} not found`,\n        details: {\n          status: 404,\n          agentId: String(id),\n          agents: Object.keys(this.#agents ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    return agent;\n  }\n\n  /**\n   * Returns all registered agents as a record keyed by their names.\n   *\n   * This method provides access to the complete registry of agents, allowing you to\n   * iterate over them, check what agents are available, or perform bulk operations.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: {\n   *     weatherAgent: new Agent({ name: 'weather', model: openai('gpt-4o') }),\n   *     supportAgent: new Agent({ name: 'support', model: openai('gpt-4o') })\n   *   }\n   * });\n   *\n   * const allAgents = mastra.getAgents();\n   * console.log(Object.keys(allAgents)); // ['weatherAgent', 'supportAgent']\n   * ```\n   */\n  public getAgents() {\n    return this.#agents;\n  }\n\n  /**\n   * Retrieves a registered vector store by its name.\n   *\n   * @template TVectorName - The specific vector store name type from the registered vectors\n   * @throws {MastraError} When the vector store with the specified name is not found\n   *\n   * @example Using a vector store for semantic search\n   * ```typescript\n   * import { PineconeVector } from '@mastra/pinecone';\n   * import { OpenAIEmbedder } from '@mastra/embedders';\n   *\n   * const mastra = new Mastra({\n   *   vectors: {\n   *     knowledge: new PineconeVector({\n   *       apiKey: process.env.PINECONE_API_KEY,\n   *       indexName: 'knowledge-base',\n   *       embedder: new OpenAIEmbedder({\n   *         apiKey: process.env.OPENAI_API_KEY,\n   *         model: 'text-embedding-3-small'\n   *       })\n   *     }),\n   *     products: new PineconeVector({\n   *       apiKey: process.env.PINECONE_API_KEY,\n   *       indexName: 'product-catalog'\n   *     })\n   *   }\n   * });\n   *\n   * // Get a vector store and perform semantic search\n   * const knowledgeBase = mastra.getVector('knowledge');\n   * const results = await knowledgeBase.query({\n   *   query: 'How to reset password?',\n   *   topK: 5\n   * });\n   *\n   * console.log('Relevant documents:', results);\n   * ```\n   */\n  public getVector<TVectorName extends keyof TVectors>(name: TVectorName): TVectors[TVectorName] {\n    const vector = this.#vectors?.[name];\n    if (!vector) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_VECTOR_BY_NAME_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Vector with name ${String(name)} not found`,\n        details: {\n          status: 404,\n          vectorName: String(name),\n          vectors: Object.keys(this.#vectors ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return vector;\n  }\n\n  /**\n   * Returns all registered vector stores as a record keyed by their names.\n   *\n   * @example Listing all vector stores\n   * ```typescript\n   * const mastra = new Mastra({\n   *   vectors: {\n   *     documents: new PineconeVector({ indexName: 'docs' }),\n   *     images: new PineconeVector({ indexName: 'images' }),\n   *     products: new ChromaVector({ collectionName: 'products' })\n   *   }\n   * });\n   *\n   * const allVectors = mastra.getVectors();\n   * console.log(Object.keys(allVectors)); // ['documents', 'images', 'products']\n   *\n   * // Check vector store types and configurations\n   * for (const [name, vectorStore] of Object.entries(allVectors)) {\n   *   console.log(`Vector store ${name}:`, vectorStore.constructor.name);\n   * }\n   * ```\n   */\n  public getVectors() {\n    return this.#vectors;\n  }\n\n  /**\n   * Gets the currently configured deployment provider.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   deployer: new VercelDeployer({\n   *     token: process.env.VERCEL_TOKEN,\n   *     projectId: process.env.VERCEL_PROJECT_ID\n   *   })\n   * });\n   *\n   * const deployer = mastra.getDeployer();\n   * if (deployer) {\n   *   await deployer.deploy({\n   *     name: 'my-mastra-app',\n   *     environment: 'production'\n   *   });\n   * }\n   * ```\n   */\n  public getDeployer() {\n    return this.#deployer;\n  }\n\n  /**\n   * Retrieves a registered legacy workflow by its ID.\n   *\n   * Legacy workflows are the previous generation of workflow system in Mastra,\n   * maintained for backward compatibility. For new implementations, use the\n   * modern workflow system accessed via `getWorkflow()`.\n   *\n   * @template TWorkflowId - The specific workflow ID type from the registered legacy workflows\n   * @throws {MastraError} When the legacy workflow with the specified ID is not found\n   * @deprecated Use `getWorkflow()` for new implementations\n   *\n   * @example Getting a legacy workflow\n   * ```typescript\n   * const mastra = new Mastra({\n   *   legacy_workflows: {\n   *     oldDataFlow: legacyWorkflowInstance\n   *   }\n   * });\n   *\n   * const workflow = mastra.legacy_getWorkflow('oldDataFlow');\n   * const result = await workflow.execute({ input: 'data' });\n   * ```\n   */\n  public legacy_getWorkflow<TWorkflowId extends keyof TLegacyWorkflows>(\n    id: TWorkflowId,\n    { serialized }: { serialized?: boolean } = {},\n  ): TLegacyWorkflows[TWorkflowId] {\n    const workflow = this.#legacy_workflows?.[id];\n    if (!workflow) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_LEGACY_WORKFLOW_BY_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Workflow with ID ${String(id)} not found`,\n        details: {\n          status: 404,\n          workflowId: String(id),\n          workflows: Object.keys(this.#legacy_workflows ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    if (serialized) {\n      return { name: workflow.name } as TLegacyWorkflows[TWorkflowId];\n    }\n\n    return workflow;\n  }\n\n  /**\n   * Retrieves a registered workflow by its ID.\n   *\n   * @template TWorkflowId - The specific workflow ID type from the registered workflows\n   * @throws {MastraError} When the workflow with the specified ID is not found\n   *\n   * @example Getting and executing a workflow\n   * ```typescript\n   * import { createWorkflow, createStep } from '@mastra/core/workflows';\n   * import { z } from 'zod';\n   *\n   * const processDataWorkflow = createWorkflow({\n   *   name: 'process-data',\n   *   triggerSchema: z.object({ input: z.string() })\n   * })\n   *   .then(validateStep)\n   *   .then(transformStep)\n   *   .then(saveStep)\n   *   .commit();\n   *\n   * const mastra = new Mastra({\n   *   workflows: {\n   *     dataProcessor: processDataWorkflow\n   *   }\n   * });\n   * ```\n   */\n  public getWorkflow<TWorkflowId extends keyof TWorkflows>(\n    id: TWorkflowId,\n    { serialized }: { serialized?: boolean } = {},\n  ): TWorkflows[TWorkflowId] {\n    const workflow = this.#workflows?.[id];\n    if (!workflow) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_WORKFLOW_BY_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Workflow with ID ${String(id)} not found`,\n        details: {\n          status: 404,\n          workflowId: String(id),\n          workflows: Object.keys(this.#workflows ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    if (serialized) {\n      return { name: workflow.name } as TWorkflows[TWorkflowId];\n    }\n\n    return workflow;\n  }\n\n  __registerInternalWorkflow(workflow: Workflow) {\n    workflow.__registerMastra(this);\n    workflow.__registerPrimitives({\n      logger: this.getLogger(),\n      storage: this.storage,\n    });\n    this.#internalMastraWorkflows[workflow.id] = workflow;\n  }\n\n  __hasInternalWorkflow(id: string): boolean {\n    return Object.values(this.#internalMastraWorkflows).some(workflow => workflow.id === id);\n  }\n\n  __getInternalWorkflow(id: string): Workflow {\n    const workflow = Object.values(this.#internalMastraWorkflows).find(a => a.id === id);\n    if (!workflow) {\n      throw new MastraError({\n        id: 'MASTRA_GET_INTERNAL_WORKFLOW_BY_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.SYSTEM,\n        text: `Workflow with id ${String(id)} not found`,\n        details: {\n          status: 404,\n          workflowId: String(id),\n        },\n      });\n    }\n\n    return workflow;\n  }\n\n  /**\n   * Retrieves a registered workflow by its unique ID.\n   *\n   * This method searches for a workflow using its internal ID property. If no workflow\n   * is found with the given ID, it also attempts to find a workflow using the ID as\n   * a name (for backward compatibility).\n   *\n   * @throws {MastraError} When no workflow is found with the specified ID\n   *\n   * @example Finding a workflow by ID\n   * ```typescript\n   * const mastra = new Mastra({\n   *   workflows: {\n   *     dataProcessor: createWorkflow({\n   *       name: 'process-data',\n   *       triggerSchema: z.object({ input: z.string() })\n   *     }).commit()\n   *   }\n   * });\n   *\n   * // Get the workflow's ID\n   * const workflow = mastra.getWorkflow('dataProcessor');\n   * const workflowId = workflow.id;\n   *\n   * // Later, retrieve the workflow by ID\n   * const sameWorkflow = mastra.getWorkflowById(workflowId);\n   * console.log(sameWorkflow.name); // \"process-data\"\n   * ```\n   */\n  public getWorkflowById(id: string): Workflow {\n    let workflow = Object.values(this.#workflows).find(a => a.id === id);\n\n    if (!workflow) {\n      try {\n        workflow = this.getWorkflow(id as any);\n      } catch {\n        // do nothing\n      }\n    }\n\n    if (!workflow) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_WORKFLOW_BY_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Workflow with id ${String(id)} not found`,\n        details: {\n          status: 404,\n          workflowId: String(id),\n          workflows: Object.keys(this.#workflows ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    return workflow;\n  }\n\n  /**\n   * Returns all registered legacy workflows as a record keyed by their IDs.\n   *\n   * Legacy workflows are the previous generation of workflow system in Mastra,\n   * maintained for backward compatibility. For new implementations, use `getWorkflows()`.\n   *\n   * @deprecated Use `getWorkflows()` for new implementations\n   *\n   * @example Listing all legacy workflows\n   * ```typescript\n   * const mastra = new Mastra({\n   *   legacy_workflows: {\n   *     oldFlow1: legacyWorkflow1,\n   *     oldFlow2: legacyWorkflow2\n   *   }\n   * });\n   *\n   * const allLegacyWorkflows = mastra.legacy_getWorkflows();\n   * console.log(Object.keys(allLegacyWorkflows)); // ['oldFlow1', 'oldFlow2']\n   *\n   * // Execute all legacy workflows\n   * for (const [id, workflow] of Object.entries(allLegacyWorkflows)) {\n   *   console.log(`Legacy workflow ${id}:`, workflow.name);\n   * }\n   * ```\n   */\n  public legacy_getWorkflows(props: { serialized?: boolean } = {}): Record<string, LegacyWorkflow> {\n    if (props.serialized) {\n      return Object.entries(this.#legacy_workflows).reduce((acc, [k, v]) => {\n        return {\n          ...acc,\n          [k]: { name: v.name },\n        };\n      }, {});\n    }\n    return this.#legacy_workflows;\n  }\n\n  /**\n   * Returns all registered scorers as a record keyed by their IDs.\n   *\n   * @example Listing all scorers\n   * ```typescript\n   * import { HelpfulnessScorer, AccuracyScorer, RelevanceScorer } from '@mastra/scorers';\n   *\n   * const mastra = new Mastra({\n   *   scorers: {\n   *     helpfulness: new HelpfulnessScorer(),\n   *     accuracy: new AccuracyScorer(),\n   *     relevance: new RelevanceScorer()\n   *   }\n   * });\n   *\n   * const allScorers = mastra.getScorers();\n   * console.log(Object.keys(allScorers)); // ['helpfulness', 'accuracy', 'relevance']\n   *\n   * // Check scorer configurations\n   * for (const [id, scorer] of Object.entries(allScorers)) {\n   *   console.log(`Scorer ${id}:`, scorer.name, scorer.description);\n   * }\n   * ```\n   */\n  public getScorers() {\n    return this.#scorers;\n  }\n\n  /**\n   * Retrieves a registered scorer by its key.\n   *\n   * @template TScorerKey - The specific scorer key type from the registered scorers\n   * @throws {MastraError} When the scorer with the specified key is not found\n   *\n   * @example Getting and using a scorer\n   * ```typescript\n   * import { HelpfulnessScorer, AccuracyScorer } from '@mastra/scorers';\n   *\n   * const mastra = new Mastra({\n   *   scorers: {\n   *     helpfulness: new HelpfulnessScorer({\n   *       model: openai('gpt-4o'),\n   *       criteria: 'Rate how helpful this response is'\n   *     }),\n   *     accuracy: new AccuracyScorer({\n   *       model: 'openai/gpt-5'\n   *     })\n   *   }\n   * });\n   *\n   * // Get a specific scorer\n   * const helpfulnessScorer = mastra.getScorer('helpfulness');\n   * const score = await helpfulnessScorer.score({\n   *   input: 'How do I reset my password?',\n   *   output: 'You can reset your password by clicking the forgot password link.',\n   *   expected: 'Detailed password reset instructions'\n   * });\n   *\n   * console.log('Helpfulness score:', score);\n   * ```\n   */\n  public getScorer<TScorerKey extends keyof TScorers>(key: TScorerKey): TScorers[TScorerKey] {\n    const scorer = this.#scorers?.[key];\n    if (!scorer) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_SCORER_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Scorer with ${String(key)} not found`,\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return scorer;\n  }\n\n  /**\n   * Retrieves a registered scorer by its name.\n   *\n   * This method searches through all registered scorers to find one with the specified name.\n   * Unlike `getScorer()` which uses the registration key, this method uses the scorer's\n   * internal name property.\n   *\n   * @throws {MastraError} When no scorer is found with the specified name\n   *\n   * @example Finding a scorer by name\n   * ```typescript\n   * import { HelpfulnessScorer } from '@mastra/scorers';\n   *\n   * const mastra = new Mastra({\n   *   scorers: {\n   *     myHelpfulnessScorer: new HelpfulnessScorer({\n   *       name: 'helpfulness-evaluator',\n   *       model: 'openai/gpt-5'\n   *     })\n   *   }\n   * });\n   *\n   * // Find scorer by its internal name, not the registration key\n   * const scorer = mastra.getScorerByName('helpfulness-evaluator');\n   * const score = await scorer.score({\n   *   input: 'question',\n   *   output: 'answer'\n   * });\n   * ```\n   */\n  public getScorerByName(name: string): MastraScorer<any, any, any, any> {\n    for (const [_key, value] of Object.entries(this.#scorers ?? {})) {\n      if (value.name === name) {\n        return value;\n      }\n    }\n\n    const error = new MastraError({\n      id: 'MASTRA_GET_SCORER_BY_NAME_NOT_FOUND',\n      domain: ErrorDomain.MASTRA,\n      category: ErrorCategory.USER,\n      text: `Scorer with name ${String(name)} not found`,\n    });\n    this.#logger?.trackException(error);\n    throw error;\n  }\n\n  /**\n   * Returns all registered workflows as a record keyed by their IDs.\n   *\n   * @example Listing all workflows\n   * ```typescript\n   * const mastra = new Mastra({\n   *   workflows: {\n   *     dataProcessor: createWorkflow({...}).commit(),\n   *     emailSender: createWorkflow({...}).commit(),\n   *     reportGenerator: createWorkflow({...}).commit()\n   *   }\n   * });\n   *\n   * const allWorkflows = mastra.getWorkflows();\n   * console.log(Object.keys(allWorkflows)); // ['dataProcessor', 'emailSender', 'reportGenerator']\n   *\n   * // Execute all workflows with sample data\n   * for (const [id, workflow] of Object.entries(allWorkflows)) {\n   *   console.log(`Workflow ${id}:`, workflow.name);\n   *   // const result = await workflow.execute(sampleData);\n   * }\n   * ```\n   */\n  public getWorkflows(props: { serialized?: boolean } = {}): Record<string, Workflow> {\n    if (props.serialized) {\n      return Object.entries(this.#workflows).reduce((acc, [k, v]) => {\n        return {\n          ...acc,\n          [k]: { name: v.name },\n        };\n      }, {});\n    }\n    return this.#workflows;\n  }\n\n  /**\n   * Sets the storage provider for the Mastra instance.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   *\n   * // Set PostgreSQL storage\n   * mastra.setStorage(new PostgresStore({\n   *   connectionString: process.env.DATABASE_URL\n   * }));\n   *\n   * // Now agents can use memory with the storage\n   * const agent = new Agent({\n   *   name: 'assistant',\n   *   memory: new Memory({ storage: mastra.getStorage() })\n   * });\n   * ```\n   */\n  public setStorage(storage: MastraStorage) {\n    this.#storage = augmentWithInit(storage);\n  }\n\n  public setLogger({ logger }: { logger: TLogger }) {\n    this.#logger = logger;\n\n    if (this.#agents) {\n      Object.keys(this.#agents).forEach(key => {\n        this.#agents?.[key]?.__setLogger(this.#logger);\n      });\n    }\n\n    if (this.#memory) {\n      this.#memory.__setLogger(this.#logger);\n    }\n\n    if (this.#deployer) {\n      this.#deployer.__setLogger(this.#logger);\n    }\n\n    if (this.#tts) {\n      Object.keys(this.#tts).forEach(key => {\n        this.#tts?.[key]?.__setLogger(this.#logger);\n      });\n    }\n\n    if (this.#storage) {\n      this.#storage.__setLogger(this.#logger);\n    }\n\n    if (this.#vectors) {\n      Object.keys(this.#vectors).forEach(key => {\n        this.#vectors?.[key]?.__setLogger(this.#logger);\n      });\n    }\n\n    if (this.#mcpServers) {\n      Object.keys(this.#mcpServers).forEach(key => {\n        this.#mcpServers?.[key]?.__setLogger(this.#logger);\n      });\n    }\n\n    // Set logger for AI tracing instances\n    const allTracingInstances = getAllAITracing();\n    allTracingInstances.forEach(instance => {\n      instance.__setLogger(this.#logger);\n    });\n  }\n\n  public setTelemetry(telemetry: OtelConfig) {\n    this.#telemetry = Telemetry.init(telemetry);\n\n    if (this.#agents) {\n      Object.keys(this.#agents).forEach(key => {\n        if (this.#telemetry) {\n          this.#agents?.[key]?.__setTelemetry(this.#telemetry);\n        }\n      });\n    }\n\n    if (this.#memory) {\n      this.#memory = this.#telemetry.traceClass(this.#memory, {\n        excludeMethods: ['__setTelemetry', '__getTelemetry'],\n      });\n      this.#memory.__setTelemetry(this.#telemetry);\n    }\n\n    if (this.#deployer) {\n      this.#deployer = this.#telemetry.traceClass(this.#deployer, {\n        excludeMethods: ['__setTelemetry', '__getTelemetry'],\n      });\n      this.#deployer.__setTelemetry(this.#telemetry);\n    }\n\n    if (this.#tts) {\n      let tts = {} as Record<string, MastraTTS>;\n      Object.entries(this.#tts).forEach(([key, ttsCl]) => {\n        if (this.#telemetry) {\n          tts[key] = this.#telemetry.traceClass(ttsCl, {\n            excludeMethods: ['__setTelemetry', '__getTelemetry'],\n          });\n          tts[key].__setTelemetry(this.#telemetry);\n        }\n      });\n      this.#tts = tts as TTTS;\n    }\n\n    if (this.#storage) {\n      this.#storage = this.#telemetry.traceClass(this.#storage, {\n        excludeMethods: ['__setTelemetry', '__getTelemetry'],\n      });\n      this.#storage.__setTelemetry(this.#telemetry);\n    }\n\n    if (this.#vectors) {\n      let vectors = {} as Record<string, MastraVector>;\n      Object.entries(this.#vectors).forEach(([key, vector]) => {\n        if (this.#telemetry) {\n          vectors[key] = this.#telemetry.traceClass(vector, {\n            excludeMethods: ['__setTelemetry', '__getTelemetry'],\n          });\n          vectors[key].__setTelemetry(this.#telemetry);\n        }\n      });\n      this.#vectors = vectors as TVectors;\n    }\n  }\n\n  /**\n   * Gets all registered text-to-speech (TTS) providers.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   tts: {\n   *     openai: new OpenAITTS({\n   *       apiKey: process.env.OPENAI_API_KEY,\n   *       voice: 'alloy'\n   *     })\n   *   }\n   * });\n   *\n   * const ttsProviders = mastra.getTTS();\n   * const openaiTTS = ttsProviders?.openai;\n   * if (openaiTTS) {\n   *   const audioBuffer = await openaiTTS.synthesize('Hello, world!');\n   * }\n   * ```\n   */\n  public getTTS() {\n    return this.#tts;\n  }\n\n  /**\n   * Gets the currently configured logger instance.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   logger: new PinoLogger({\n   *     name: 'MyApp',\n   *     level: 'info'\n   *   })\n   * });\n   *\n   * const logger = mastra.getLogger();\n   * logger.info('Application started');\n   * logger.error('An error occurred', { error: 'details' });\n   * ```\n   */\n  public getLogger() {\n    return this.#logger;\n  }\n\n  /**\n   * Gets the currently configured telemetry instance.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   telemetry: {\n   *     enabled: true,\n   *     serviceName: 'my-mastra-app'\n   *   }\n   * });\n   *\n   * const telemetry = mastra.getTelemetry();\n   * if (telemetry) {\n   *   const span = telemetry.startSpan('custom-operation');\n   *   span.setAttributes({ operation: 'data-processing' });\n   *   span.end();\n   * }\n   * ```\n   *\n   * @deprecated use {@link getAITracing()} instead\n   */\n  public getTelemetry() {\n    return this.#telemetry;\n  }\n\n  /**\n   * Gets the currently configured memory instance.\n   *\n   * @deprecated Memory should be configured directly on agents instead of on the Mastra instance.\n   * Use `new Agent({ memory: new Memory() })` instead.\n   *\n   * @example Legacy memory usage (deprecated)\n   * ```typescript\n   * // This approach is deprecated\n   * const mastra = new Mastra({\n   *   // memory: new Memory() // This is no longer supported\n   * });\n   *\n   * // Use this instead:\n   * const agent = new Agent({\n   *   name: 'assistant',\n   *   memory: new Memory({\n   *     storage: new LibSQLStore({ url: ':memory:' })\n   *   })\n   * });\n   * ```\n   */\n  public getMemory() {\n    return this.#memory;\n  }\n\n  /**\n   * Gets the currently configured storage provider.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   storage: new LibSQLStore({ url: 'file:./data.db' })\n   * });\n   *\n   * // Use the storage in agent memory\n   * const agent = new Agent({\n   *   name: 'assistant',\n   *   memory: new Memory({\n   *     storage: mastra.getStorage()\n   *   })\n   * });\n   * ```\n   */\n  public getStorage() {\n    return this.#storage;\n  }\n\n  public getServerMiddleware() {\n    return this.#serverMiddleware;\n  }\n\n  public getServerCache() {\n    return this.#serverCache;\n  }\n\n  public setServerMiddleware(serverMiddleware: Middleware | Middleware[]) {\n    if (typeof serverMiddleware === 'function') {\n      this.#serverMiddleware = [\n        {\n          handler: serverMiddleware,\n          path: '/api/*',\n        },\n      ];\n      return;\n    }\n\n    if (!Array.isArray(serverMiddleware)) {\n      const error = new MastraError({\n        id: 'MASTRA_SET_SERVER_MIDDLEWARE_INVALID_TYPE',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Invalid middleware: expected a function or array, received ${typeof serverMiddleware}`,\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    this.#serverMiddleware = serverMiddleware.map(m => {\n      if (typeof m === 'function') {\n        return {\n          handler: m,\n          path: '/api/*',\n        };\n      }\n      return {\n        handler: m.handler,\n        path: m.path || '/api/*',\n      };\n    });\n  }\n\n  public getServer() {\n    return this.#server;\n  }\n\n  public getBundlerConfig() {\n    return this.#bundler;\n  }\n\n  public async getLogsByRunId({\n    runId,\n    transportId,\n    fromDate,\n    toDate,\n    logLevel,\n    filters,\n    page,\n    perPage,\n  }: {\n    runId: string;\n    transportId: string;\n    fromDate?: Date;\n    toDate?: Date;\n    logLevel?: LogLevel;\n    filters?: Record<string, any>;\n    page?: number;\n    perPage?: number;\n  }) {\n    if (!transportId) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_LOGS_BY_RUN_ID_MISSING_TRANSPORT',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: 'Transport ID is required',\n        details: {\n          runId,\n          transportId,\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    if (!this.#logger?.getLogsByRunId) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_LOGS_BY_RUN_ID_LOGGER_NOT_CONFIGURED',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.SYSTEM,\n        text: 'Logger is not configured or does not support getLogsByRunId operation',\n        details: {\n          runId,\n          transportId,\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    return await this.#logger.getLogsByRunId({\n      runId,\n      transportId,\n      fromDate,\n      toDate,\n      logLevel,\n      filters,\n      page,\n      perPage,\n    });\n  }\n\n  public async getLogs(\n    transportId: string,\n    params?: {\n      fromDate?: Date;\n      toDate?: Date;\n      logLevel?: LogLevel;\n      filters?: Record<string, any>;\n      page?: number;\n      perPage?: number;\n    },\n  ) {\n    if (!transportId) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_LOGS_MISSING_TRANSPORT',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: 'Transport ID is required',\n        details: {\n          transportId,\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    if (!this.#logger) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_LOGS_LOGGER_NOT_CONFIGURED',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.SYSTEM,\n        text: 'Logger is not set',\n        details: {\n          transportId,\n        },\n      });\n      throw error;\n    }\n\n    return await this.#logger.getLogs(transportId, params);\n  }\n\n  /**\n   * Gets all registered Model Context Protocol (MCP) server instances.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   mcpServers: {\n   *     filesystem: new FileSystemMCPServer({\n   *       rootPath: '/app/data'\n   *     })\n   *   }\n   * });\n   *\n   * const mcpServers = mastra.getMCPServers();\n   * if (mcpServers) {\n   *   const fsServer = mcpServers.filesystem;\n   *   const tools = await fsServer.getTools();\n   * }\n   * ```\n   */\n  public getMCPServers(): Record<string, MCPServerBase> | undefined {\n    return this.#mcpServers;\n  }\n\n  /**\n   * Retrieves a specific Model Context Protocol (MCP) server instance by its logical ID.\n   *\n   * This method searches for an MCP server using its logical ID. If a version is specified,\n   * it returns the exact version match. If no version is provided, it returns the server\n   * with the most recent release date.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   mcpServers: {\n   *     filesystem: new FileSystemMCPServer({\n   *       id: 'fs-server',\n   *       version: '1.0.0',\n   *       rootPath: '/app/data'\n   *     })\n   *   }\n   * });\n   *\n   * const fsServer = mastra.getMCPServer('fs-server');\n   * if (fsServer) {\n   *   const tools = await fsServer.getTools();\n   * }\n   * ```\n   */\n  public getMCPServer(serverId: string, version?: string): MCPServerBase | undefined {\n    if (!this.#mcpServers) {\n      return undefined;\n    }\n\n    const allRegisteredServers = Object.values(this.#mcpServers || {});\n\n    const matchingLogicalIdServers = allRegisteredServers.filter(server => server.id === serverId);\n\n    if (matchingLogicalIdServers.length === 0) {\n      this.#logger?.debug(`No MCP servers found with logical ID: ${serverId}`);\n      return undefined;\n    }\n\n    if (version) {\n      const specificVersionServer = matchingLogicalIdServers.find(server => server.version === version);\n      if (!specificVersionServer) {\n        this.#logger?.debug(`MCP server with logical ID '${serverId}' found, but not version '${version}'.`);\n      }\n      return specificVersionServer;\n    } else {\n      // No version specified, find the one with the most recent releaseDate\n      if (matchingLogicalIdServers.length === 1) {\n        return matchingLogicalIdServers[0];\n      }\n\n      matchingLogicalIdServers.sort((a, b) => {\n        // Ensure releaseDate exists and is a string before creating a Date object\n        const dateAVal = a.releaseDate && typeof a.releaseDate === 'string' ? new Date(a.releaseDate).getTime() : NaN;\n        const dateBVal = b.releaseDate && typeof b.releaseDate === 'string' ? new Date(b.releaseDate).getTime() : NaN;\n\n        if (isNaN(dateAVal) && isNaN(dateBVal)) return 0;\n        if (isNaN(dateAVal)) return 1; // Treat invalid/missing dates as older\n        if (isNaN(dateBVal)) return -1; // Treat invalid/missing dates as older\n\n        return dateBVal - dateAVal; // Sorts in descending order of time (latest first)\n      });\n\n      // After sorting, the first element should be the latest if its date is valid\n      if (matchingLogicalIdServers.length > 0) {\n        const latestServer = matchingLogicalIdServers[0];\n        if (\n          latestServer &&\n          latestServer.releaseDate &&\n          typeof latestServer.releaseDate === 'string' &&\n          !isNaN(new Date(latestServer.releaseDate).getTime())\n        ) {\n          return latestServer;\n        }\n      }\n      this.#logger?.warn(\n        `Could not determine the latest server for logical ID '${serverId}' due to invalid or missing release dates, or no servers left after filtering.`,\n      );\n      return undefined;\n    }\n  }\n\n  public async addTopicListener(topic: string, listener: (event: any) => Promise<void>) {\n    await this.#pubsub.subscribe(topic, listener);\n  }\n\n  public async removeTopicListener(topic: string, listener: (event: any) => Promise<void>) {\n    await this.#pubsub.unsubscribe(topic, listener);\n  }\n\n  public async startEventEngine() {\n    for (const topic in this.#events) {\n      if (!this.#events[topic]) {\n        continue;\n      }\n\n      const listeners = Array.isArray(this.#events[topic]) ? this.#events[topic] : [this.#events[topic]];\n      for (const listener of listeners) {\n        await this.#pubsub.subscribe(topic, listener);\n      }\n    }\n  }\n\n  public async stopEventEngine() {\n    for (const topic in this.#events) {\n      if (!this.#events[topic]) {\n        continue;\n      }\n\n      const listeners = Array.isArray(this.#events[topic]) ? this.#events[topic] : [this.#events[topic]];\n      for (const listener of listeners) {\n        await this.#pubsub.unsubscribe(topic, listener);\n      }\n    }\n\n    await this.#pubsub.flush();\n  }\n\n  /**\n   * Gracefully shuts down the Mastra instance and cleans up all resources.\n   *\n   * This method performs a clean shutdown of all Mastra components, including:\n   * - AI tracing registry and all tracing instances\n   * - Event engine and pub/sub system\n   * - All registered components and their resources\n   *\n   * It's important to call this method when your application is shutting down\n   * to ensure proper cleanup and prevent resource leaks.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: { myAgent },\n   *   workflows: { myWorkflow }\n   * });\n   *\n   * // Graceful shutdown on SIGINT\n   * process.on('SIGINT', async () => {\n   *   await mastra.shutdown();\n   *   process.exit(0);\n   * });\n   * ```\n   */\n  async shutdown(): Promise<void> {\n    // Shutdown AI tracing registry and all instances\n    await shutdownAITracingRegistry();\n    await this.stopEventEngine();\n\n    this.#logger?.info('Mastra shutdown completed');\n  }\n\n  // This method is only used internally for server hnadlers that require temporary persistence\n  public get serverCache() {\n    return this.#serverCache;\n  }\n}\n","import EventEmitter from 'events';\nimport { PubSub } from './pubsub';\nimport type { Event } from './types';\n\nexport class EventEmitterPubSub extends PubSub {\n  private emitter: EventEmitter;\n\n  constructor() {\n    super();\n    this.emitter = new EventEmitter();\n  }\n\n  async publish(topic: string, event: Omit<Event, 'id' | 'createdAt'>): Promise<void> {\n    const id = crypto.randomUUID();\n    const createdAt = new Date();\n    this.emitter.emit(topic, {\n      ...event,\n      id,\n      createdAt,\n    });\n  }\n\n  async subscribe(topic: string, cb: (event: Event, ack?: () => Promise<void>) => void): Promise<void> {\n    this.emitter.on(topic, cb);\n  }\n\n  async unsubscribe(topic: string, cb: (event: Event, ack?: () => Promise<void>) => void): Promise<void> {\n    this.emitter.off(topic, cb);\n  }\n\n  async flush(): Promise<void> {\n    // no-op\n  }\n}\n","import type { Mastra } from '..';\nimport { ErrorCategory, ErrorDomain, MastraError } from '../error';\nimport { saveScorePayloadSchema } from '../scores';\nimport type { ScoringHookInput } from '../scores/types';\nimport type { MastraStorage } from '../storage';\n\nexport function createOnScorerHook(mastra: Mastra) {\n  return async (hookData: ScoringHookInput) => {\n    const storage = mastra.getStorage();\n\n    if (!storage) {\n      mastra.getLogger()?.warn('Storage not found, skipping score validation and saving');\n      return;\n    }\n\n    const entityId = hookData.entity.id;\n    const entityType = hookData.entityType;\n    const scorer = hookData.scorer;\n    try {\n      const scorerToUse = await findScorer(mastra, entityId, entityType, scorer.name);\n\n      if (!scorerToUse) {\n        throw new MastraError({\n          id: 'MASTRA_SCORER_NOT_FOUND',\n          domain: ErrorDomain.MASTRA,\n          category: ErrorCategory.USER,\n          text: `Scorer with ID ${hookData.scorer.id} not found`,\n        });\n      }\n\n      let input = hookData.input;\n      let output = hookData.output;\n\n      const { structuredOutput, ...rest } = hookData;\n\n      const runResult = await scorerToUse.scorer.run({\n        ...rest,\n        input,\n        output,\n      });\n\n      const payload = {\n        ...rest,\n        ...runResult,\n        entityId,\n        scorerId: hookData.scorer.name,\n        metadata: {\n          structuredOutput: !!structuredOutput,\n        },\n      };\n\n      await validateAndSaveScore(storage, payload);\n    } catch (error) {\n      const mastraError = new MastraError(\n        {\n          id: 'MASTRA_SCORER_FAILED_TO_RUN_HOOK',\n          domain: ErrorDomain.SCORER,\n          category: ErrorCategory.USER,\n          details: {\n            scorerId: scorer.id,\n            entityId,\n            entityType,\n          },\n        },\n        error,\n      );\n\n      mastra.getLogger()?.trackException(mastraError);\n      mastra.getLogger()?.error(mastraError.toString());\n    }\n  };\n}\n\nexport async function validateAndSaveScore(storage: MastraStorage, payload: unknown) {\n  const payloadToSave = saveScorePayloadSchema.parse(payload);\n  await storage?.saveScore(payloadToSave);\n}\n\nasync function findScorer(mastra: Mastra, entityId: string, entityType: string, scorerName: string) {\n  let scorerToUse;\n  if (entityType === 'AGENT') {\n    const scorers = await mastra.getAgentById(entityId).getScorers();\n    for (const [_, scorer] of Object.entries(scorers)) {\n      if (scorer.scorer.name === scorerName) {\n        scorerToUse = scorer;\n        break;\n      }\n    }\n  } else if (entityType === 'WORKFLOW') {\n    const scorers = await mastra.getWorkflowById(entityId).getScorers();\n    for (const [_, scorer] of Object.entries(scorers)) {\n      if (scorer.scorer.name === scorerName) {\n        scorerToUse = scorer;\n        break;\n      }\n    }\n  }\n\n  // Fallback to mastra-registered scorer\n  if (!scorerToUse) {\n    const mastraRegisteredScorer = mastra.getScorerByName(scorerName);\n    scorerToUse = mastraRegisteredScorer ? { scorer: mastraRegisteredScorer } : undefined;\n  }\n\n  return scorerToUse;\n}\n"]}