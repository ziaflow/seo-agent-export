import type { GenerateTextOnStepFinishCallback, TelemetrySettings, ToolSet } from 'ai';
import type { JSONSchema7 } from 'json-schema';
import type { ZodSchema } from 'zod';
import type { AISpan, AISpanType, TracingContext, TracingOptions, TracingPolicy } from '../ai-tracing/index.js';
import type { Metric } from '../eval/index.js';
import type { CoreMessage, DefaultLLMStreamOptions, DefaultLLMStreamObjectOptions, DefaultLLMTextObjectOptions, DefaultLLMTextOptions, OutputType, SystemMessage, MastraModelConfig } from '../llm/index.js';
import type { StreamTextOnFinishCallback, StreamTextOnStepFinishCallback, StreamObjectOnFinishCallback } from '../llm/model/base.types.js';
import type { Mastra } from '../mastra/index.js';
import type { MastraMemory } from '../memory/memory.js';
import type { MastraLanguageModel, MemoryConfig, StorageThreadType } from '../memory/types.js';
import type { InputProcessor, OutputProcessor } from '../processors/index.js';
import type { RuntimeContext } from '../runtime-context/index.js';
import type { MastraScorer, MastraScorers, ScoringSamplingConfig } from '../scores/index.js';
import type { OutputSchema } from '../stream/index.js';
import type { InferSchemaOutput } from '../stream/base/schema.js';
import type { ModelManagerModelConfig } from '../stream/types.js';
import type { ToolAction, VercelTool, VercelToolV5 } from '../tools/index.js';
import type { DynamicArgument } from '../types/index.js';
import type { CompositeVoice } from '../voice/index.js';
import type { Workflow } from '../workflows/index.js';
import type { Agent } from './agent.js';
import type { AgentExecutionOptions } from './agent.types.js';
import type { MessageList } from './message-list/index.js';
import type { SaveQueueManager } from './save-queue/index.js';
export type { MastraMessageV2, MastraMessageContentV2, UIMessageWithMetadata, MessageList } from './message-list/index.js';
export type { Message as AiMessageType } from 'ai';
export type { LLMStepResult } from '../stream/types.js';
export type ToolsInput = Record<string, ToolAction<any, any, any> | VercelTool | VercelToolV5>;
export type AgentInstructions = SystemMessage;
export type DynamicAgentInstructions = DynamicArgument<AgentInstructions>;
export type ToolsetsInput = Record<string, ToolsInput>;
type FallbackFields<OUTPUT extends OutputSchema = undefined> = {
    errorStrategy?: 'strict' | 'warn';
    fallbackValue?: never;
} | {
    errorStrategy: 'fallback';
    fallbackValue: InferSchemaOutput<OUTPUT>;
};
export type StructuredOutputOptions<OUTPUT extends OutputSchema = undefined> = {
    /** Zod schema to validate the output against */
    schema: OUTPUT;
    /** Model to use for the internal structuring agent. If not provided, falls back to the agent's model */
    model?: MastraLanguageModel;
    /**
     * Custom instructions for the structuring agent.
     * If not provided, will generate instructions based on the schema.
     */
    instructions?: string;
} & FallbackFields<OUTPUT>;
/**
 * Provide options while creating an agent.
 */
export interface AgentCreateOptions {
    tracingPolicy?: TracingPolicy;
}
type DynamicModel = ({ runtimeContext, mastra, }: {
    runtimeContext: RuntimeContext;
    mastra?: Mastra;
}) => Promise<MastraModelConfig> | MastraModelConfig;
type ModelWithRetries = {
    id?: string;
    model: MastraModelConfig | DynamicModel;
    maxRetries?: number;
    enabled?: boolean;
};
export interface AgentConfig<TAgentId extends string = string, TTools extends ToolsInput = ToolsInput, TMetrics extends Record<string, Metric> = Record<string, Metric>> {
    /**
     * Identifier for the agent.
     * @defaultValue Uses `name` if not provided.
     */
    id?: TAgentId;
    /**
     * Unique identifier for the agent.
     */
    name: TAgentId;
    /**
     * Description of the agent's purpose and capabilities.
     */
    description?: string;
    /**
     * Instructions that guide the agent's behavior. Can be a string, array of strings, system message object,
     * array of system messages, or a function that returns any of these types dynamically.
     */
    instructions: DynamicAgentInstructions;
    /**
     * The language model used by the agent. Can be provided statically or resolved at runtime.
     */
    model: MastraModelConfig | DynamicModel | ModelWithRetries[];
    /**
     * Maximum number of retries for model calls in case of failure.
     * @defaultValue 0
     */
    maxRetries?: number;
    /**
     * Tools that the agent can access. Can be provided statically or resolved dynamically.
     */
    tools?: DynamicArgument<TTools>;
    /**
     * Workflows that the agent can execute. Can be static or dynamically resolved.
     */
    workflows?: DynamicArgument<Record<string, Workflow<any, any, any, any, any, any>>>;
    /**
     * Default options used when calling `generate()`.
     */
    defaultGenerateOptions?: DynamicArgument<AgentGenerateOptions>;
    /**
     * Default options used when calling `stream()`.
     */
    defaultStreamOptions?: DynamicArgument<AgentStreamOptions>;
    /**
     * Default options used when calling `stream()` in vNext mode.
     */
    defaultVNextStreamOptions?: DynamicArgument<AgentExecutionOptions>;
    /**
     * Reference to the Mastra runtime instance (injected automatically).
     */
    mastra?: Mastra;
    /**
     * Sub-Agents that the agent can access. Can be provided statically or resolved dynamically.
     */
    agents?: DynamicArgument<Record<string, Agent>>;
    /**
     * Scoring configuration for runtime evaluation and telemetry. Can be static or dynamically provided.
     */
    scorers?: DynamicArgument<MastraScorers>;
    /**
     * Evaluation metrics for scoring agent responses.
     */
    evals?: TMetrics;
    /**
     * Memory module used for storing and retrieving stateful context.
     */
    memory?: DynamicArgument<MastraMemory>;
    /**
     * Voice settings for speech input and output.
     */
    voice?: CompositeVoice;
    /**
     * Input processors that can modify or validate messages before they are processed by the agent. These processors need to implement the `processInput` function.
     */
    inputProcessors?: DynamicArgument<InputProcessor[]>;
    /**
     * Output processors that can modify or validate messages from the agent, before it is sent to the client. These processors need to implement either (or both) of the `processOutputResult` and `processOutputStream` functions.
     */
    outputProcessors?: DynamicArgument<OutputProcessor[]>;
    /**
     * Options to pass to the agent upon creation.
     */
    options?: AgentCreateOptions;
}
export type AgentMemoryOption = {
    thread: string | (Partial<StorageThreadType> & {
        id: string;
    });
    resource: string;
    options?: MemoryConfig;
    readOnly?: boolean;
};
/**
 * Options for generating responses with an agent
 * @template OUTPUT - The schema type for structured output (Zod schema or JSON schema)
 * @template EXPERIMENTAL_OUTPUT - The schema type for structured output generation alongside tool calls (Zod schema or JSON schema)
 */
export type AgentGenerateOptions<OUTPUT extends ZodSchema | JSONSchema7 | undefined = undefined, EXPERIMENTAL_OUTPUT extends ZodSchema | JSONSchema7 | undefined = undefined> = {
    /** Optional instructions to override the agent's default instructions */
    instructions?: SystemMessage;
    /** Additional tool sets that can be used for this generation */
    toolsets?: ToolsetsInput;
    clientTools?: ToolsInput;
    /** Additional context messages to include */
    context?: CoreMessage[];
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    memoryOptions?: MemoryConfig;
    /** New memory options (preferred) */
    memory?: AgentMemoryOption;
    /** Unique ID for this generation run */
    runId?: string;
    /** Callback fired after each generation step completes */
    onStepFinish?: OUTPUT extends undefined ? GenerateTextOnStepFinishCallback<any> : never;
    /** Maximum number of steps allowed for generation */
    maxSteps?: number;
    /** Schema for structured output, does not work with tools, use experimental_output instead */
    output?: OutputType | OUTPUT;
    /** Schema for structured output generation alongside tool calls. */
    experimental_output?: EXPERIMENTAL_OUTPUT;
    /** Controls how tools are selected during generation */
    toolChoice?: 'auto' | 'none' | 'required' | {
        type: 'tool';
        toolName: string;
    };
    /** Telemetry settings */
    telemetry?: TelemetrySettings;
    /** RuntimeContext for dependency injection */
    runtimeContext?: RuntimeContext;
    /** Scorers to use for this generation */
    scorers?: MastraScorers | Record<string, {
        scorer: MastraScorer['name'];
        sampling?: ScoringSamplingConfig;
    }>;
    /** Whether to return the input required to run scorers for agents, defaults to false */
    returnScorerData?: boolean;
    /**
     * Whether to save messages incrementally on step finish
     * @default false
     */
    savePerStep?: boolean;
    /** Input processors to use for this generation call (overrides agent's default) */
    inputProcessors?: InputProcessor[];
    /** Output processors to use for this generation call (overrides agent's default) */
    outputProcessors?: OutputProcessor[];
    /** AI tracing context for span hierarchy and metadata */
    tracingContext?: TracingContext;
    /** AI tracing options for starting new traces */
    tracingOptions?: TracingOptions;
} & ({
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    resourceId?: undefined;
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    threadId?: undefined;
} | {
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    resourceId: string;
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    threadId: string;
}) & (OUTPUT extends undefined ? DefaultLLMTextOptions : DefaultLLMTextObjectOptions);
/**
 * Options for streaming responses with an agent
 * @template OUTPUT - The schema type for structured output (Zod schema or JSON schema)
 * @template EXPERIMENTAL_OUTPUT - The schema type for structured output generation alongside tool calls (Zod schema or JSON schema)
 */
export type AgentStreamOptions<OUTPUT extends ZodSchema | JSONSchema7 | undefined = undefined, EXPERIMENTAL_OUTPUT extends ZodSchema | JSONSchema7 | undefined = undefined> = {
    /** Optional instructions to override the agent's default instructions */
    instructions?: SystemMessage;
    /** Additional tool sets that can be used for this generation */
    toolsets?: ToolsetsInput;
    clientTools?: ToolsInput;
    /** Additional context messages to include */
    context?: CoreMessage[];
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    memoryOptions?: MemoryConfig;
    /** New memory options (preferred) */
    memory?: AgentMemoryOption;
    /** Unique ID for this generation run */
    runId?: string;
    /** Callback fired when streaming completes */
    onFinish?: OUTPUT extends undefined ? StreamTextOnFinishCallback<any> : StreamObjectOnFinishCallback<OUTPUT>;
    /** Callback fired after each generation step completes */
    onStepFinish?: OUTPUT extends undefined ? StreamTextOnStepFinishCallback<any> : never;
    /** Maximum number of steps allowed for generation */
    maxSteps?: number;
    /** Schema for structured output */
    output?: OutputType | OUTPUT;
    /** Temperature parameter for controlling randomness */
    temperature?: number;
    /** Controls how tools are selected during generation */
    toolChoice?: 'auto' | 'none' | 'required' | {
        type: 'tool';
        toolName: string;
    };
    /** Experimental schema for structured output */
    experimental_output?: EXPERIMENTAL_OUTPUT;
    /** Telemetry settings */
    telemetry?: TelemetrySettings;
    /** RuntimeContext for dependency injection */
    runtimeContext?: RuntimeContext;
    /**
     * Whether to save messages incrementally on step finish
     * @default false
     */
    savePerStep?: boolean;
    /** Input processors to use for this generation call (overrides agent's default) */
    inputProcessors?: InputProcessor[];
    /** AI tracing context for span hierarchy and metadata */
    tracingContext?: TracingContext;
    /** AI tracing options for starting new traces */
    tracingOptions?: TracingOptions;
    /** Scorers to use for this generation */
    scorers?: MastraScorers | Record<string, {
        scorer: MastraScorer['name'];
        sampling?: ScoringSamplingConfig;
    }>;
} & ({
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    resourceId?: undefined;
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    threadId?: undefined;
} | {
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    resourceId: string;
    /**
     * @deprecated Use the `memory` property instead for all memory-related options.
     */
    threadId: string;
}) & (OUTPUT extends undefined ? DefaultLLMStreamOptions : DefaultLLMStreamObjectOptions);
export type AgentModelManagerConfig = ModelManagerModelConfig & {
    enabled: boolean;
};
export type AgentExecuteOnFinishOptions = {
    instructions: SystemMessage;
    runId: string;
    result: Parameters<StreamTextOnFinishCallback<ToolSet>>[0] & {
        object?: unknown;
    };
    thread: StorageThreadType | null | undefined;
    readOnlyMemory?: boolean;
    threadId?: string;
    resourceId?: string;
    runtimeContext: RuntimeContext;
    agentAISpan?: AISpan<AISpanType.AGENT_RUN>;
    memoryConfig: MemoryConfig | undefined;
    outputText: string;
    messageList: MessageList;
    threadExists: boolean;
    structuredOutput?: boolean;
    saveQueueManager: SaveQueueManager;
    overrideScorers?: MastraScorers | Record<string, {
        scorer: MastraScorer['name'];
        sampling?: ScoringSamplingConfig;
    }>;
};
//# sourceMappingURL=types.d.ts.map